(function(){"use strict";const Z={sand:1,water:2,dirt:3,stone:4,plant:5,fire:6,gas:7,fluff:8,bug:9,plasma:10,nitro:11,glass:12,lightning:13,slime:14,ant:15,alien:16,quark:17,crystal:18,ember:19,static:20,bird:21,gunpowder:22,tap:23,anthill:24,bee:25,flower:26,hive:27,honey:28,nest:29,gun:30,cloud:40,acid:41,lava:42,snow:43,volcano:44,mold:45,mercury:46,void:47,seed:48,rust:49,spore:50,algae:51,poison:52,dust:53,firework:54,bubble:55,glitter:56,star:57,comet:58,blackhole:60,firefly:61},g=4;function D(n,t,i){t/=100,i/=100;const s=t*Math.min(i,1-i),d=u=>{const M=(u+n/30)%12;return i-s*Math.max(Math.min(M-3,9-M,1),-1)};return 255<<24|Math.round(d(4)*255)<<16|Math.round(d(8)*255)<<8|Math.round(d(0)*255)}const z=new Uint32Array([4279900698,4285450470,4292448330,4281031307,4284900966,4280453922,0,4287137928,4292077301,4290013695,0,4279566137,4293580968,0,4281519514,4279904875,4278255360,4294902015,4294955136,4280303871,4294967108,4293454056,4281348144,4290822336,4281368752,4278245631,4294919372,4282431720,4281377023,4286611616,4283453520,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282703359,4292399304,4278255551,4279506140,4294963424,4278190182,4293814395,4291346616,4283697198,4285834708,4279124407,4289376800,4282216485,4287299723,4287084766,4278216447,4293643911,4290822336,4278247423,4294965629,4294938654,4278190080,4278255551]),m=new Uint32Array(32),w=new Uint32Array(64),V=new Uint32Array(32),K=new Uint32Array(32);for(let n=0;n<32;n++)m[n]=D(10+n,100,50+n/32*20),V[n]=D(50+n/32*20,100,80+n/32*20),K[n]=D(200+n/32*20,100,50+n/32*30);for(let n=0;n<64;n++)w[n]=D(n<32?280+n:320+(n-32),100,60+n/64*25);const J=4279900698;let F=null,W=null,_=null,h=new Uint8Array(0),L=0,P=0,q=!1,k=[];function Q(n,t){L=Math.floor(n/g),P=Math.floor(t/g),h=new Uint8Array(L*P),W&&(_=W.createImageData(n,t))}function $(n,t,i,s){const d=i==="erase"?0:Z[i];if(d===30){if(n>=0&&n<L&&t>=0&&t<P){const u=t*L+n;h[u]!==4&&h[u]!==23&&h[u]!==30&&h[u]!==60&&(h[u]=30)}return}for(let u=-s;u<=s;u++)for(let M=-s;M<=s;M++)if(M*M+u*u<=s*s){const l=n+M,I=t+u;if(l>=0&&l<L&&I>=0&&I<P){const R=I*L+l;let A=.3;d===21||d===25||d===61?A=.8:d===15||d===9||d===14?A=.7:d===16||d===17?A=.92:(d===45||d===50)&&(A=.6),(i==="erase"||Math.random()>A)&&(i==="erase"||h[R]!==4&&h[R]!==23&&h[R]!==60)&&(h[R]=d)}}}function nn(){const n=h,t=Math.random,i=(s,d)=>d*L+s;for(let s=0;s<P;s++){const d=t()<.5;for(let u=0;u<L;u++){const M=d?u:L-1-u,l=i(M,s),I=n[l];if(I!==0){if(I>=31&&I<=38){const R=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],A=I-31,[T,o]=R[A];if(o>0||T!==0&&T>0===d)continue;const e=M+T,f=s+o;if(e<0||e>=L||f<0||f>=P){n[l]=39;continue}const E=i(e,f),c=n[E];if(c===22||c===11){n[E]=6,n[l]=39;continue}if(c===9||c===15||c===21||c===25||c===14){n[E]=I,n[l]=39;continue}if(c===2){if(t()<.15)n[l]=39;else{if(t()<.5)continue;n[E]=I,n[l]=39}continue}if(c===30){const r=e+T,a=f+o;if(r>=0&&r<L&&a>=0&&a<P){const Y=i(r,a);n[Y]===0&&(n[Y]=I)}n[l]=39;continue}if(c===46){const r=[35,36,37,38,31,32,33,34];n[l]=r[I-31];continue}if(c===5||c===26||c===12||c===8||c===7||c>=31&&c<=38||c===39){n[E]=I,n[l]=39;continue}if(c===4||c===3||c===1){t()<.2||(n[E]=I),n[l]=39;continue}if(c===0){n[E]=I,n[l]=39;continue}n[l]=39;continue}if(I===6||I===59){if(s===0){n[l]=0;continue}if(t()<.1){n[l]=t()<.25?7:t()<.15?19:0;continue}for(let A=0;A<3;A++){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(T===0&&o===0)continue;const e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];(c===5||c===8||c===9||c===7||c===22||c===26||c===27||c===29)&&t()<.5&&(n[E]=6)}}const R=i(M,s-1);if(s>0&&n[R]===0)n[R]=I,n[l]=0;else{const A=t()<.5?-1:1;s>0&&M+A>=0&&M+A<L&&n[i(M+A,s-1)]===0&&(n[i(M+A,s-1)]=I,n[l]=0)}}else if(I===7){if(s===0){n[l]=0;continue}if(t()<.02){n[l]=0;continue}const R=i(M,s-1);if(s>0&&n[R]===0)n[R]=7,n[l]=0;else{const A=t()<.5?-1:1;s>0&&M+A>=0&&M+A<L&&n[i(M+A,s-1)]===0?(n[i(M+A,s-1)]=7,n[l]=0):M+A>=0&&M+A<L&&n[i(M+A,s)]===0&&(n[i(M+A,s)]=7,n[l]=0)}}else if(I===50){if(t()<.01){n[l]=0;continue}for(let R=0;R<3;R++){const A=Math.floor(t()*3)-1,T=Math.floor(t()*3)-1;if(A===0&&T===0)continue;const o=M+A,e=s+T;if(o>=0&&o<L&&e>=0&&e<P){const f=n[i(o,e)];if((f===5||f===26||f===8||f===28||f===3||f===51)&&t()<.35){n[i(o,e)]=45,n[l]=0;break}}}if(t()<.4){const R=Math.floor(t()*3)-1,A=t()<.6?-1:t()<.5?0:1,T=M+R,o=s+A;T>=0&&T<L&&o>=0&&o<P&&n[i(T,o)]===0&&(n[i(T,o)]=50,n[l]=0)}}else if(I===40){if(s<P-1&&n[i(M,s+1)]===0&&t()<.04&&(n[i(M,s+1)]=2),t()<.3){const R=t()<.5?-1:1,A=t()<.3?-1:t()<.5?1:0,T=M+R,o=s+A;T>=0&&T<L&&o>=0&&o<P&&n[i(T,o)]===0&&(n[i(T,o)]=40,n[l]=0)}}else if(I===54)if(s>0&&t()<.95){const R=i(M,s-1);if(n[R]===0)n[R]=54,n[l]=0;else{n[l]=0;const A=8,T=[6,19,20,10,56,59];for(let o=-A;o<=A;o++)for(let e=-A;e<=A;e++)if(e*e+o*o<=A*A&&t()<.5){const f=M+e,E=s+o;f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===0&&(n[i(f,E)]=T[Math.floor(t()*T.length)])}}}else{n[l]=0;const R=7,A=[6,19,20,10,56,59];for(let T=-R;T<=R;T++)for(let o=-R;o<=R;o++)if(o*o+T*T<=R*R&&t()<.45){const e=M+o,f=s+T;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=A[Math.floor(t()*A.length)])}}else if(I===55){let R=!1;for(let A=0;A<3;A++){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=n[i(e,f)];if(E===2||E===41||E===28||E===52){R=!0;break}}}if(R){if(s>0&&t()<.6){const A=i(M,s-1),T=n[A];if(T===2||T===41||T===28||T===52)n[A]=55,n[l]=T;else if(T===0){n[l]=0;for(let o=0;o<3;o++){const e=M+Math.floor(t()*3)-1,f=s-1-Math.floor(t()*2);e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=2)}}}if(t()<.2){const A=t()<.5?-1:1;if(M+A>=0&&M+A<L){const T=i(M+A,s),o=n[T];(o===2||o===41||o===28||o===52)&&(n[T]=55,n[l]=o)}}}else n[l]=7}else if(I===58){const R=t()<.8?-2:-1,A=Math.floor(t()*3)-1;let T=!1;for(let o=Math.abs(R);o>0;o--){const e=s-o,f=M+(o===Math.abs(R)?A:0);if(e>=0&&e<P&&f>=0&&f<L){const E=i(f,e),c=n[E];if(c===0){n[E]=58,n[l]=59,T=!0;break}else if(c===2){n[E]=7,n[l]=59,T=!0;break}else if(c===5||c===8||c===26){n[E]=59,n[l]=59,T=!0;break}else if(c===1){n[E]=12,n[l]=59,T=!0;break}else{n[l]=0;for(let r=-2;r<=2;r++)for(let a=-2;a<=2;a++){const Y=M+a,N=s+r;Y>=0&&Y<L&&N>=0&&N<P&&n[i(Y,N)]===0&&(n[i(Y,N)]=t()<.6?59:19)}T=!0;break}}}(!T||t()<.05)&&(n[l]=59)}else if(I===10){if(s===0){n[l]=0;continue}if(t()<.08){n[l]=0;continue}for(let A=0;A<3;A++){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(T===0&&o===0)continue;const e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=n[i(e,f)];E===1&&t()<.5?n[i(e,f)]=10:(E===5||E===8||E===7||E===26)&&t()<.5&&(n[i(e,f)]=6)}}const R=i(M,s-1);if(s>0&&n[R]===0)n[R]=10,n[l]=0;else{const A=t()<.5?-1:1;s>0&&M+A>=0&&M+A<L&&n[i(M+A,s-1)]===0&&(n[i(M+A,s-1)]=10,n[l]=0)}}else if(I===13){if(t()<.2){n[l]=t()<.2?20:0;continue}let R=!1;for(let A=1;A<=3&&!R;A++){const T=s+A;if(T>=P)break;const o=i(M,T),e=n[o];if(e===1){n[o]=12,n[l]=0,R=!0;for(let f=0;f<3;f++){let E=M,c=T,r=t()<.5?-1:1;for(let a=0;a<8&&(t()<.3&&(r=t()<.5?-1:1),E+=r,c+=t()<.8?1:0,!(E<0||E>=L||c>=P));a++){const Y=i(E,c);if(n[Y]===1)n[Y]=12;else if(n[Y]!==0&&n[Y]!==12)break}}}else if(e===2){n[o]=13,n[l]=0,R=!0;for(let f=-3;f<=3;f++){const E=M+f;E>=0&&E<L&&n[i(E,T)]===2&&t()<.7&&(n[i(E,T)]=13)}}else if(e===5||e===8||e===9)n[o]=6,n[l]=0,R=!0;else if(e===11){n[l]=0;const f=15;for(let E=-f;E<=f;E++)for(let c=-f;c<=f;c++)if(c*c+E*E<=f*f){const r=M+c,a=T+E;if(r>=0&&r<L&&a>=0&&a<P){const Y=i(r,a),N=n[Y];N===2?n[Y]=t()<.7?4:0:N!==4&&N!==12&&(n[Y]=6)}}R=!0}else if(e===4||e===12)n[l]=0,R=!0;else if(e===3)t()<.4&&(n[o]=12),n[l]=0,R=!0;else{if(e===0)continue;n[l]=0,R=!0}}if(!R&&s+1<P&&n[i(M,s+1)]===0){if(n[i(M,s+1)]=13,n[l]=0,t()<.15){const A=M+(t()<.5?-1:1);A>=0&&A<L&&n[i(A,s)]===0&&(n[i(A,s)]=13)}}else R||(n[l]=0)}else if(I===21){let R=!1;for(let c=0;c<2;c++){const r=Math.floor(t()*3)-1,a=Math.floor(t()*3)-1;if(r===0&&a===0)continue;const Y=M+r,N=s+a;if(Y>=0&&Y<L&&N>=0&&N<P){const S=n[i(Y,N)];if(S===6||S===10||S===13||S===19){n[l]=6;for(let O=0;O<4;O++){const U=M+Math.floor(t()*3)-1,B=s+Math.floor(t()*3)-1;U>=0&&U<L&&B>=0&&B<P&&n[i(U,B)]===0&&t()<.5&&(n[i(U,B)]=6)}R=!0;break}if(S===16||S===17){n[l]=0,R=!0;break}}}if(R)continue;if(t()<.003){n[l]=8;continue}if(t()<.4)continue;const A=t(),T=t();let o=0,e=0;if(A<.5?(e=-1,o=T<.35?-1:T<.7?1:0):A<.75?(o=T<.5?-2:2,e=T<.4?-1:0):A<.9&&(e=1,o=T<.5?-1:1),o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=i(f,E),r=n[c];r===15||r===9||r===25?(n[c]=21,n[l]=t()<.6?21:5):(r===0||r===8)&&(n[c]=21,n[l]=0)}}else if(I===25){let R=!1;for(let c=0;c<2;c++){const r=Math.floor(t()*3)-1,a=Math.floor(t()*3)-1;if(r===0&&a===0)continue;const Y=M+r,N=s+a;if(Y>=0&&Y<L&&N>=0&&N<P){const S=n[i(Y,N)];if(S===6||S===10||S===13||S===19){n[l]=6,R=!0;break}}}if(R)continue;const A=t(),T=t();let o=0,e=0;if(A<.3?(e=-1,o=T<.4?-1:T<.8?1:0):A<.5?(e=1,o=T<.4?-1:T<.8?1:0):A<.8&&(o=T<.5?-1:1,e=T<.3?-1:T<.6?1:0),o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=i(f,E),r=n[c];if(r===5){if(t()<.08)for(let a=-1;a<=1;a++)for(let Y=-1;Y<=1;Y++){if(a===0&&Y===0)continue;const N=f+Y,S=E+a;if(N>=0&&N<L&&S>=0&&S<P&&n[i(N,S)]===0){n[i(N,S)]=26;break}}}else r===0?(n[c]=25,n[l]=0):r===26&&(n[c]=25,n[l]=t()<.1?28:t()<.15?0:26)}}else if(I===61){let R=!1;for(let E=0;E<2;E++){const c=Math.floor(t()*3)-1,r=Math.floor(t()*3)-1;if(c===0&&r===0)continue;const a=M+c,Y=s+r;if(a>=0&&a<L&&Y>=0&&Y<P){const N=n[i(a,Y)];if(N===6||N===10||N===42){n[l]=6,R=!0;break}if(N===2||N===41){n[l]=0,R=!0;break}if(N===21){n[l]=0,R=!0;break}}}if(R)continue;if(t()<.15){const E=Math.floor(t()*3)-1,c=Math.floor(t()*3)-1,r=M+E,a=s+c;r>=0&&r<L&&a>=0&&a<P&&n[i(r,a)]===0&&(n[i(r,a)]=t()<.7?56:20)}if(t()<.5)continue;let A={x:0,y:0};for(let E=0;E<3;E++){const c=Math.floor(t()*9)-4,r=Math.floor(t()*9)-4,a=M+c,Y=s+r;if(a>=0&&a<L&&Y>=0&&Y<P&&n[i(a,Y)]===26){A={x:Math.sign(c),y:Math.sign(r)};break}}let T=0,o=0;if(A.x!==0||A.y!==0)T=A.x,o=A.y;else{const E=t();E<.25?(o=-1,T=t()<.5?-1:1):E<.4?(o=1,T=t()<.5?-1:1):E<.7&&(T=t()<.5?-1:1)}if(T===0&&o===0)continue;const e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];if(c===0)n[E]=61,n[l]=0;else if(c===26&&t()<.03){const r=M+Math.floor(t()*3)-1,a=s+Math.floor(t()*3)-1;r>=0&&r<L&&a>=0&&a<P&&n[i(r,a)]===0&&(n[i(r,a)]=61)}}}}}}for(let s=P-2;s>=0;s--){const d=t()<.5;for(let u=0;u<L;u++){const M=d?u:L-1-u,l=i(M,s),I=n[l];if(I===0)continue;const R=i(M,s+1),A=n[R];if(I===35||I===34||I===36){const T=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],o=I-31,[e,f]=T[o];if(e!==0&&e>0===d)continue;const E=M+e,c=s+f;if(E<0||E>=L||c<0||c>=P){n[l]=39;continue}const r=i(E,c),a=n[r];if(a===22||a===11){n[r]=6,n[l]=39;continue}if(a===9||a===15||a===21||a===25||a===14){n[r]=I,n[l]=39;continue}if(a===2){if(t()<.15)n[l]=39;else{if(t()<.5)continue;n[r]=I,n[l]=39}continue}if(a===30){const Y=E+e,N=c+f;Y>=0&&Y<L&&N>=0&&N<P&&n[i(Y,N)]===0&&(n[i(Y,N)]=I),n[l]=39;continue}if(a===46){const Y=[35,36,37,38,31,32,33,34];n[l]=Y[I-31];continue}if(a===5||a===26||a===12||a===8||a===7||a>=31&&a<=38||a===39){n[r]=I,n[l]=39;continue}if(a===4||a===3||a===1){t()<.2||(n[r]=I),n[l]=39;continue}if(a===0){n[r]=I,n[l]=39;continue}n[l]=39;continue}if(I===39){t()<.3&&(n[l]=0);continue}if(I===23){s<P-1&&n[R]===0&&t()<.15&&(n[R]=2);continue}if(I===24){if(t()<.06){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=15)}continue}if(I===27){if(t()<.035){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=25)}continue}if(I===29){if(t()<.02){const T=Math.floor(t()*3)-1,o=-1,e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=21)}continue}if(I===30){if(t()<.08){const T=[31,32,33,34,35,36,37,38],o=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],e=Math.floor(t()*8);for(let f=0;f<8;f++){const E=(e+f)%8,[c,r]=o[E],a=M+c,Y=s+r;if(a>=0&&a<L&&Y>=0&&Y<P&&n[i(a,Y)]===0){n[i(a,Y)]=T[E];break}}}continue}if(I===1)if(A===0)n[R]=1,n[l]=0;else if(A===2||A===41)n[R]=1,n[l]=A;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=1,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0&&(n[i(e,s+1)]=1,n[l]=0)}else if(I===2)if(A===0)n[R]=2,n[l]=0;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=2,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=2,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0?(n[i(o,s)]=2,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0&&(n[i(e,s)]=2,n[l]=0)}else if(I===3)A===0?(n[R]=3,n[l]=0):A===2&&(n[R]=3,n[l]=2);else if(I===8){if(t()<.3&&A===0)n[R]=8,n[l]=0;else if(t()<.15){const T=t()<.5?-1:1;M+T>=0&&M+T<L&&n[i(M+T,s+1)]===0&&(n[i(M+T,s+1)]=8,n[l]=0)}}else if(I===9){for(let E=0;E<2;E++){const c=Math.floor(t()*3)-1,r=Math.floor(t()*3)-1;if(c===0&&r===0)continue;const a=M+c,Y=s+r;if(a>=0&&a<L&&Y>=0&&Y<P){const N=n[i(a,Y)];if(N===6||N===10||N===13||N===19){n[l]=6;break}}}if(n[l]!==9||t()<.5)continue;const T=Math.floor(t()*3)-1,o=t()<.7?1:Math.floor(t()*3)-1;if(T===0&&o===0)continue;const e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];c===5?(n[E]=9,n[l]=t()<.3?0:3):c===0?(n[E]=9,n[l]=0):c===2&&(n[E]=9,n[l]=2)}}else if(I===11){const T=()=>{for(let f=-12;f<=12;f++)for(let E=-12;E<=12;E++)if(E*E+f*f<=144){const c=M+E,r=s+f;if(c>=0&&c<L&&r>=0&&r<P){const a=i(c,r),Y=n[a];Y===2?n[a]=t()<.7?4:0:Y!==4&&Y!==12&&(n[a]=6)}}};let o=!1;for(let e=-1;e<=1&&!o;e++)for(let f=-1;f<=1&&!o;f++){if(f===0&&e===0)continue;const E=M+f,c=s+e;if(E>=0&&E<L&&c>=0&&c<P){const r=n[i(E,c)];r!==0&&r!==2&&r!==11&&(o=!0)}}if(!o&&A!==0&&A!==2&&A!==11&&(o=!0),!o&&s>0){const e=n[i(M,s-1)];e!==0&&e!==2&&e!==11&&(o=!0)}if(o){T();continue}if(n[l]!==11)continue;if(A===0)n[R]=11,n[l]=0;else if(A===2)n[R]=11,n[l]=2;else{const e=t()<.5?-1:1,f=M+e,E=M-e;f>=0&&f<L&&n[i(f,s+1)]===0?(n[i(f,s+1)]=11,n[l]=0):E>=0&&E<L&&n[i(E,s+1)]===0?(n[i(E,s+1)]=11,n[l]=0):f>=0&&f<L&&n[i(f,s)]===0?(n[i(f,s)]=11,n[l]=0):E>=0&&E<L&&n[i(E,s)]===0&&(n[i(E,s)]=11,n[l]=0)}}else if(I===14){for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];if(c===6||c===10||c===19||c===42){n[l]=7;break}}}if(n[l]!==14||t()<.6)continue;if(A===0)n[R]=14,n[l]=0;else{const T=t()<.5?-1:1,o=M+T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=14,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0&&t()<.3&&(n[i(o,s)]=14,n[l]=0)}}else if(I===15){let T=!1;for(let Y=0;Y<2;Y++){const N=Math.floor(t()*3)-1,S=Math.floor(t()*3)-1;if(N===0&&S===0)continue;const O=M+N,U=s+S;if(O>=0&&O<L&&U>=0&&U<P){const B=n[i(O,U)];if(B===6||B===10||B===13||B===19||B===42){n[l]=6,T=!0;break}if(B===2||B===41){n[l]=0,T=!0;break}}}if(T||t()<.5)continue;let o=s>0&&(n[i(M,s-1)]===5||n[i(M,s-1)]===26),e=M>0&&(n[i(M-1,s)]===5||n[i(M-1,s)]===26),f=M<L-1&&(n[i(M+1,s)]===5||n[i(M+1,s)]===26);const E=e?-1:f?1:Math.floor(t()*3)-1,c=o?-1:t()<.3?1:Math.floor(t()*3)-1;if(E===0&&c===0)continue;const r=M+E,a=s+c;if(r>=0&&r<L&&a>=0&&a<P){const Y=i(r,a),N=n[Y];(N===3||N===1||N===0||N===5||N===26)&&(n[Y]=15,n[l]=0)}}else if(I===16){if(t()<.4)continue;const T=Math.floor(t()*3)-1,o=t()<.3?1:Math.floor(t()*3)-1;if(T===0&&o===0)continue;const e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];c===0?(n[E]=16,n[l]=t()<.1?14:0):c===9||c===15||c===21||c===25||c===14||c===5||c===26?(n[E]=16,n[l]=14):(c===6||c===10||c===13)&&(n[l]=14)}}else if(I===17){if(t()<.03){n[l]=t()<.33?18:t()<.5?19:20;continue}const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(T===0&&o===0)continue;const e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=17,n[l]=0)}else if(I===18)t()<.002&&(n[l]=1);else if(I===19){if(t()<.05){n[l]=t()<.3?6:0;continue}for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];(c===5||c===8||c===7||c===26)&&t()<.4&&(n[i(f,E)]=6)}}if(A===0)n[R]=19,n[l]=0;else{const T=t()<.5?-1:1;M+T>=0&&M+T<L&&n[i(M+T,s+1)]===0&&(n[i(M+T,s+1)]=19,n[l]=0)}}else if(I===20){if(t()<.08){n[l]=0;continue}const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(T!==0||o!==0){const e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=20,n[l]=0)}}else if(I===22){for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];if(c===6||c===10||c===19||c===42){for(let a=-6;a<=6;a++)for(let Y=-6;Y<=6;Y++)if(Y*Y+a*a<=36){const N=M+Y,S=s+a;if(N>=0&&N<L&&S>=0&&S<P){const O=i(N,S),U=n[O];U!==4&&U!==12&&U!==2&&(n[O]=6)}}break}}}if(n[l]!==22)continue;if(A===0)n[R]=22,n[l]=0;else if(A===2)n[R]=22,n[l]=2;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=22,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0&&(n[i(e,s+1)]=22,n[l]=0)}}else if(I===28){if(t()>.15)continue;if(A===0)n[R]=28,n[l]=0;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=28,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=28,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0&&t()<.3?(n[i(o,s)]=28,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0&&t()<.3&&(n[i(e,s)]=28,n[l]=0)}}else if(I===41){let T=!1;for(let o=0;o<3;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const E=M+e,c=s+f;if(E>=0&&E<L&&c>=0&&c<P){const r=i(E,c),a=n[r];if((a===5||a===3||a===1||a===8||a===26||a===14)&&t()<.3){n[r]=t()<.7?0:7,t()<.4&&(n[l]=0,T=!0);break}if((a===4||a===12||a===18)&&t()<.08){n[r]=0,n[l]=0,T=!0;break}if((a===9||a===15||a===21||a===25)&&t()<.5){n[r]=41;break}}}if(T)continue;if(A===0)n[R]=41,n[l]=0;else{const o=t()<.5?-1:1,e=M+o,f=M-o;e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=41,n[l]=0):f>=0&&f<L&&n[i(f,s+1)]===0?(n[i(f,s+1)]=41,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0?(n[i(e,s)]=41,n[l]=0):f>=0&&f<L&&n[i(f,s)]===0&&(n[i(f,s)]=41,n[l]=0)}}else if(I===42){for(let T=0;T<3;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=i(f,E),r=n[c];if(r===2){if(n[c]=t()<.5?4:7,t()<.15){n[l]=4;break}}else r===43?n[c]=2:r===1&&t()<.4?n[c]=12:((r===5||r===8||r===7||r===26||r===22||r===27||r===29)&&t()<.7||(r===9||r===15||r===21||r===25)&&t()<.8)&&(n[c]=6)}}if(t()<.001){n[l]=4;continue}if(t()>.15)continue;if(A===0)n[R]=42,n[l]=0;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=42,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=42,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0&&t()<.3?(n[i(o,s)]=42,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0&&t()<.3&&(n[i(e,s)]=42,n[l]=0)}}else if(I===43){let T=!1;if(t()<.4)for(let o=-1;o<=1&&!T;o++)for(let e=-1;e<=1&&!T;e++){if(o===0&&e===0)continue;const f=M+e,E=s+o;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];(c===6||c===10||c===19||c===42)&&t()<.6?(n[l]=2,T=!0):c===2&&t()<.04&&(n[i(f,E)]=12)}}if(T)continue;if(t()<.25&&A===0)n[R]=43,n[l]=0;else if(t()<.1){const o=t()<.5?-1:1;M+o>=0&&M+o<L&&n[i(M+o,s+1)]===0&&(n[i(M+o,s+1)]=43,n[l]=0)}}else if(I===44){for(let T=0;T<3;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];if(c===2){if(n[i(f,E)]=7,t()<.08){n[l]=4;continue}}else c===43&&(n[i(f,E)]=2)}}if(n[l]===4)continue;if(t()<.55&&s>0){const T=i(M,s-1);n[T]===0&&(n[T]=42)}if(t()<.25){const T=t()<.5?-1:1;if(M+T>=0&&M+T<L&&s>0){const o=i(M+T,s-1);n[o]===0&&(n[o]=42)}}if(t()<.1){const T=Math.floor(t()*3)-1,o=Math.floor(t()*2)-1,e=M+T,f=s+o;e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=19)}}else if(I===45){if(t()<.008){n[l]=0;continue}for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];if(c===6||c===10||c===42||c===41){n[l]=c===41?0:6;break}}}if(n[l]===6||n[l]===0)continue;if(t()<.08){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];c===5||c===26||c===8||c===28||c===3?(n[E]=45,t()<.2&&(n[l]=t()<.4?50:7)):(c===9||c===15||c===14)&&t()<.3?n[E]=45:c===0&&t()<.1&&(n[E]=45,n[l]=t()<.3?7:0)}}}else if(I===46){for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];(c===9||c===15||c===21||c===25||c===14)&&t()<.5&&(n[i(f,E)]=0)}}if(A===0)n[R]=46,n[l]=0;else if(A===2||A===41||A===28||A===1||A===3)t()<.7&&(n[R]=46,n[l]=A);else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=46,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=46,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0?(n[i(o,s)]=46,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0&&(n[i(e,s)]=46,n[l]=0)}}else if(I===47){if(t()<.003){n[l]=0;continue}for(let T=0;T<2;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===13){n[l]=20;break}}if(n[l]===20)continue;if(t()<.1){const T=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=M+T,f=s+o;if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];if(c!==0&&c!==4&&c!==12&&c!==18&&c!==47&&c!==23&&c!==44&&(n[E]=0,t()<.02)){const r=M+Math.floor(t()*3)-1,a=s+Math.floor(t()*3)-1;r>=0&&r<L&&a>=0&&a<P&&n[i(r,a)]===0&&(n[i(r,a)]=47)}}}}else if(I===5){let T=!1;for(let o=-1;o<=1;o++){for(let e=-1;e<=1;e++){if(e===0&&o===0)continue;const f=M+e,E=s+o;if(f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===2){T=!0;break}}if(T)break}if(T&&t()<.15){const o=Math.floor(t()*3)-1,e=t()<.7?-1:Math.floor(t()*3)-1,f=M+o,E=s+e;f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===2&&(n[i(f,E)]=t()<.1?26:5)}}else if(I===48){const T=s>0?i(M,s-1):-1,o=T>=0?n[T]:0;if(!(A===2&&o!==2&&t()<.7)){if(A===2&&o===2){n[T]=48,n[l]=2;continue}else if(A===0){n[R]=48,n[l]=0;continue}}const e=Math.floor(t()*8),f=[0,1,1,1,0,-1,-1,-1][e],E=[-1,-1,0,1,1,1,0,-1][e],c=M+f,r=s+E;if(c>=0&&c<L&&r>=0&&r<P){const x=n[i(c,r)];if(x===6||x===10||x===42){n[l]=6;continue}if((x===9||x===15||x===21)&&t()<.3){n[l]=0;continue}}if(t()>.35||!(s<P-1&&(n[R]===3||n[R]===2)||o===3||o===2||o===5))continue;let Y=!1,N=!1;for(let x=0;x<6;x++){const y=Math.floor(t()*13)-6,C=Math.floor(t()*13)-6,p=M+y,v=s+C;if(p>=0&&p<L&&v>=0&&v<P){const j=n[i(p,v)];j===2&&(Y=!0),j===57&&(N=!0)}}const S=N?.7:Y?.5:.25;if(t()>S)continue;const O=N?50:Y?30:20;let U=-1;for(let x=1;x<=O&&!(s-x<0);x++){const y=n[i(M,s-x)];if(y===0||y===2){U=s-x;break}if(y!==5&&y!==26&&y!==3&&y!==48)break}if(U>=0){const x=N?.3:Y?.15:.1;n[i(M,U)]=t()<x?26:5}const B=s-(U>=0?U:s);if(B>10&&t()<(N?.2:.1)){const x=M+(t()<.5?-1:1),y=s-Math.floor(t()*Math.min(B,15))-5,C=x>=0&&x<L&&y>=0?n[i(x,y)]:-1;(C===0||C===2)&&(n[i(x,y)]=t()<.4?26:5)}}else if(I===49){if(t()<.005){n[l]=3;continue}let T=!1;for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1,E=M+e,c=s+f;if(E>=0&&E<L&&c>=0&&c<P&&n[i(E,c)]===2){T=!0;break}}if(T&&t()<.03){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1,f=M+o,E=s+e;f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===4&&(n[i(f,E)]=49)}A===0&&t()<.1&&(n[R]=49,n[l]=0)}else if(I===51){let T=!1;if((s>0&&n[i(M,s-1)]===2||s<P-1&&n[i(M,s+1)]===2||M>0&&n[i(M-1,s)]===2||M<L-1&&n[i(M+1,s)]===2)&&(T=!0),!T&&t()<.001){n[l]=5;continue}if(T&&t()<.015&&s>0){const o=i(M,s-1);n[o]===2&&(n[o]=7)}if(T&&t()<.06){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1,f=M+o,E=s+e;f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===2&&(n[i(f,E)]=51)}for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const E=M+e,c=s+f;if(E>=0&&E<L&&c>=0&&c<P){const r=n[i(E,c)];if((r===9||r===14)&&t()<.25){n[l]=0;break}}}}else if(I===52){for(let T=0;T<3;T++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=n[i(f,E)];(c===9||c===15||c===21||c===25||c===14)&&t()<.5||c===51&&t()<.08||c===5&&t()<.05?n[i(f,E)]=52:c===2&&t()<.15&&(n[i(f,E)]=0,t()<.5&&(n[l]=2))}}if(t()>.3)continue;if(A===0)n[R]=52,n[l]=0;else{const T=t()<.5?-1:1,o=M+T,e=M-T;o>=0&&o<L&&n[i(o,s+1)]===0?(n[i(o,s+1)]=52,n[l]=0):e>=0&&e<L&&n[i(e,s+1)]===0?(n[i(e,s+1)]=52,n[l]=0):o>=0&&o<L&&n[i(o,s)]===0?(n[i(o,s)]=52,n[l]=0):e>=0&&e<L&&n[i(e,s)]===0&&(n[i(e,s)]=52,n[l]=0)}}else if(I===53){let T=!1;for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const E=M+e,c=s+f;if(E>=0&&E<L&&c>=0&&c<P){const r=n[i(E,c)];if(r===6||r===10||r===19||r===42){n[l]=6;for(let a=0;a<10;a++){const Y=Math.floor(t()*5)-2,N=Math.floor(t()*5)-2,S=M+Y,O=s+N;S>=0&&S<L&&O>=0&&O<P&&n[i(S,O)]===53&&t()<.8&&(n[i(S,O)]=6)}T=!0;break}}}if(T)continue;if(t()<.003){n[l]=1;continue}if(t()<.3){const o=Math.floor(t()*3)-1,e=t()<.6?1:t()<.5?0:-1,f=M+o,E=s+e;f>=0&&f<L&&E>=0&&E<P&&n[i(f,E)]===0&&(n[i(f,E)]=53,n[l]=0)}}else if(I===56){let T=0;for(let e=0;e<3;e++){const f=Math.floor(t()*3)-1,E=Math.floor(t()*3)-1;if(f===0&&E===0)continue;const c=M+f,r=s+E;c>=0&&c<L&&r>=0&&r<P&&n[i(c,r)]===56&&T++}const o=T===0?.15:T>0?.03:.01;if(t()<o){n[l]=0;continue}if(t()<.3)if(A===0)n[R]=56,n[l]=0;else{const e=t()<.5?-1:1;M+e>=0&&M+e<L&&n[i(M+e,s+1)]===0&&(n[i(M+e,s+1)]=56,n[l]=0)}}else if(I===57){if(t()<.12){const T=t()*6.28318,o=t()*4+1,e=M+Math.round(Math.cos(T)*o),f=s+Math.round(Math.sin(T)*o);e>=0&&e<L&&f>=0&&f<P&&n[i(e,f)]===0&&(n[i(e,f)]=t()<.6?20:56)}if(t()<.04){const T=t()*6.28318,o=t()*12+3,e=M+Math.round(Math.cos(T)*o),f=s+Math.round(Math.sin(T)*o);if(e>=0&&e<L&&f>=0&&f<P){const E=i(e,f),c=n[E];c===5&&t()<.3?n[E]=26:c===2&&t()<.1?n[E]=51:c===3&&t()<.15||c===0&&t()<.05?n[E]=5:c===43&&t()<.2?n[E]=2:c===45&&t()<.1&&(n[E]=26)}}if(t()<.02)for(let T=0;T<5;T++){const o=Math.floor(t()*5)-2,e=Math.floor(t()*5)-2,f=M+o,E=s+e;if(f>=0&&f<L&&E>=0&&E<P){const c=i(f,E);n[c]===2&&(n[c]=7)}}}else if(I===60){if(t()>.5)continue;const T=10;for(let o=0;o<16;o++){const e=t()*6.28318,f=t()*T+1,E=Math.round(Math.cos(e)*f),c=Math.round(Math.sin(e)*f);if(E===0&&c===0)continue;const r=M+E,a=s+c;if(r<0||r>=L||a<0||a>=P)continue;const Y=i(r,a),N=n[Y];if(N===0||N===60||N===44||N===30||N===24||N===27)continue;const S=E>0?-1:E<0?1:0,O=c>0?-1:c<0?1:0,U=r+S,B=a+O;if(U>=0&&U<L&&B>=0&&B<P){const x=i(U,B);Math.abs(E+S)<=1&&Math.abs(c+O)<=1?n[Y]=0:n[x]===0&&(n[x]=N,n[Y]=0)}}for(let o=-6;o<=6;o+=2){const e=M+o;if(!(e<0||e>=L))for(let f=-8;f<=2;f+=2){const E=s+f;if(E<0||E>=P)continue;const c=i(e,E),r=n[c];if(!(r===0||r===60)&&Math.abs(o)>1&&t()<.3){const a=o>0?-1:1,Y=e+a;Y>=0&&Y<L&&n[i(Y,E)]===0&&(n[i(Y,E)]=r,n[c]=0)}}}}}}}function tn(){if(!W||!_||!F)return;const n=h,t=F.width,i=new Uint32Array(_.data.buffer);i.fill(J);const s=g;for(let d=0;d<P;d++){const u=d*L,M=d*s*t;for(let l=0;l<L;l++){const I=n[u+l];if(I===0)continue;let R;I===6?R=m[l+d&31]:I===10?R=w[l+d&63]:I===13?R=V[l+d&31]:I===59?R=K[l+d&31]:R=z[I];const A=l*s,T=M+A,o=T+t,e=o+t,f=e+t;i[T]=i[T+1]=i[T+2]=i[T+3]=R,i[o]=i[o+1]=i[o+2]=i[o+3]=R,i[e]=i[e+1]=i[e+2]=i[e+3]=R,i[f]=i[f+1]=i[f+2]=i[f+3]=R}}W.putImageData(_,0,0)}let b=0,G=0;const H=1e3/60;function X(n){b===0&&(b=n);const t=Math.min(n-b,100);b=n;for(const i of k)$(i.x,i.y,i.tool,i.brushSize);k=[],q||(G+=t,G>=H&&(nn(),G=Math.min(G-H,H))),tn(),requestAnimationFrame(X)}self.onmessage=n=>{const{type:t,data:i}=n.data;switch(t){case"init":F=n.data.canvas,W=F.getContext("2d",{willReadFrequently:!1}),Q(F.width,F.height),b=0,G=0,requestAnimationFrame(X);break;case"resize":F&&(F.width=i.width,F.height=i.height,Q(i.width,i.height));break;case"input":k.push({x:i.cellX,y:i.cellY,tool:i.tool,brushSize:i.brushSize});break;case"pause":q=i.paused;break;case"reset":h.fill(0);break}}})();
