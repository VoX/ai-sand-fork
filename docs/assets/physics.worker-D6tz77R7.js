(function(){"use strict";const X={sand:1,water:2,dirt:3,stone:4,plant:5,fire:6,gas:7,fluff:8,bug:9,plasma:10,nitro:11,glass:12,lightning:13,slime:14,ant:15,alien:16,quark:17,crystal:18,ember:19,static:20,bird:21,gunpowder:22,tap:23,anthill:24,bee:25,flower:26,hive:27,honey:28,nest:29,gun:30,cloud:40,acid:41,lava:42,snow:43,volcano:44,mold:45,mercury:46,void:47,seed:48,rust:49,spore:50,algae:51,poison:52,dust:53,firework:54,bubble:55,glitter:56,star:57,comet:58,blackhole:60,firefly:61},_=4;function D(n,e,i){e/=100,i/=100;const T=e*Math.min(i,1-i),d=x=>{const l=(x+n/30)%12;return i-T*Math.max(Math.min(l-3,9-l,1),-1)};return 255<<24|Math.round(d(4)*255)<<16|Math.round(d(8)*255)<<8|Math.round(d(0)*255)}const j=new Uint32Array([4279900698,4285450470,4292448330,4281031307,4284900966,4280453922,0,4287137928,4292077301,4290013695,0,4279566137,4293580968,0,4281519514,4279904875,4278255360,4294902015,4294955136,4280303871,4294967108,4293454056,4281348144,4290822336,4281368752,4278245631,4294919372,4282431720,4281377023,4286611616,4283453520,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282703359,4292399304,4278255551,4279506140,4294963424,4278190182,4293814395,4291346616,4283697198,4285834708,4279124407,4289376800,4282216485,4287299723,4287084766,4278216447,4293643911,4290822336,4278247423,4294965629,4294938654,4278190088,4278255551]),m=new Uint32Array(32),v=new Uint32Array(64),p=new Uint32Array(32),w=new Uint32Array(32);for(let n=0;n<32;n++)m[n]=D(10+n,100,50+n/32*20),p[n]=D(50+n/32*20,100,80+n/32*20),w[n]=D(200+n/32*20,100,50+n/32*30);for(let n=0;n<64;n++)v[n]=D(n<32?280+n:320+(n-32),100,60+n/64*25);const Z=4279900698;let y=null,F=null,W=null,h=new Uint8Array(0),L=0,Y=0,V=!1,C=[];function K(n,e){L=Math.floor(n/_),Y=Math.floor(e/_),h=new Uint8Array(L*Y),F&&(W=F.createImageData(n,e))}function z(n,e,i,T){const d=i==="erase"?0:X[i];if(d===30){if(n>=0&&n<L&&e>=0&&e<Y){const x=e*L+n;h[x]!==4&&h[x]!==23&&h[x]!==30&&(h[x]=30)}return}for(let x=-T;x<=T;x++)for(let l=-T;l<=T;l++)if(l*l+x*x<=T*T){const M=n+l,a=e+x;if(M>=0&&M<L&&a>=0&&a<Y){const P=a*L+M;let r=.3;d===21||d===25||d===61?r=.8:d===15||d===9||d===14?r=.7:d===16||d===17?r=.92:(d===45||d===50)&&(r=.6),(i==="erase"||Math.random()>r)&&(i==="erase"||h[P]!==4&&h[P]!==23)&&(h[P]=d)}}}function J(){const n=h,e=Math.random,i=(T,d)=>d*L+T;for(let T=0;T<Y;T++){const d=e()<.5;for(let x=0;x<L;x++){const l=d?x:L-1-x,M=i(l,T),a=n[M];if(a!==0){if(a>=31&&a<=38){const P=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],r=a-31,[E,o]=P[r];if(o>0||E!==0&&E>0===d)continue;const t=l+E,f=T+o;if(t<0||t>=L||f<0||f>=Y){n[M]=39;continue}const c=i(t,f),s=n[c];if(s===22||s===11){n[c]=6,n[M]=39;continue}if(s===9||s===15||s===21||s===25||s===14){n[c]=a,n[M]=39;continue}if(s===2){if(e()<.15)n[M]=39;else{if(e()<.5)continue;n[c]=a,n[M]=39}continue}if(s===30){const A=t+E,R=f+o;if(A>=0&&A<L&&R>=0&&R<Y){const I=i(A,R);n[I]===0&&(n[I]=a)}n[M]=39;continue}if(s===46){const A=[35,36,37,38,31,32,33,34];n[M]=A[a-31];continue}if(s===5||s===26||s===12||s===8||s===7||s>=31&&s<=38||s===39){n[c]=a,n[M]=39;continue}if(s===4||s===3||s===1){e()<.2||(n[c]=a),n[M]=39;continue}if(s===0){n[c]=a,n[M]=39;continue}n[M]=39;continue}if(a===6||a===59){if(T===0){n[M]=0;continue}if(e()<.1){n[M]=e()<.25?7:e()<.15?19:0;continue}for(let r=0;r<3;r++){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1;if(E===0&&o===0)continue;const t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];(s===5||s===8||s===9||s===7||s===22||s===26||s===27||s===29)&&e()<.5&&(n[c]=6)}}const P=i(l,T-1);if(T>0&&n[P]===0)n[P]=a,n[M]=0;else{const r=e()<.5?-1:1;T>0&&l+r>=0&&l+r<L&&n[i(l+r,T-1)]===0&&(n[i(l+r,T-1)]=a,n[M]=0)}}else if(a===7){if(T===0){n[M]=0;continue}if(e()<.02){n[M]=0;continue}const P=i(l,T-1);if(T>0&&n[P]===0)n[P]=7,n[M]=0;else{const r=e()<.5?-1:1;T>0&&l+r>=0&&l+r<L&&n[i(l+r,T-1)]===0?(n[i(l+r,T-1)]=7,n[M]=0):l+r>=0&&l+r<L&&n[i(l+r,T)]===0&&(n[i(l+r,T)]=7,n[M]=0)}}else if(a===50){if(e()<.01){n[M]=0;continue}for(let P=0;P<3;P++){const r=Math.floor(e()*3)-1,E=Math.floor(e()*3)-1;if(r===0&&E===0)continue;const o=l+r,t=T+E;if(o>=0&&o<L&&t>=0&&t<Y){const f=n[i(o,t)];if((f===5||f===26||f===8||f===28||f===3||f===51)&&e()<.35){n[i(o,t)]=45,n[M]=0;break}}}if(e()<.4){const P=Math.floor(e()*3)-1,r=e()<.6?-1:e()<.5?0:1,E=l+P,o=T+r;E>=0&&E<L&&o>=0&&o<Y&&n[i(E,o)]===0&&(n[i(E,o)]=50,n[M]=0)}}else if(a===40){if(T<Y-1&&n[i(l,T+1)]===0&&e()<.04&&(n[i(l,T+1)]=2),e()<.3){const P=e()<.5?-1:1,r=e()<.3?-1:e()<.5?1:0,E=l+P,o=T+r;E>=0&&E<L&&o>=0&&o<Y&&n[i(E,o)]===0&&(n[i(E,o)]=40,n[M]=0)}}else if(a===54)if(T>0&&e()<.95){const P=i(l,T-1);if(n[P]===0)n[P]=54,n[M]=0;else{n[M]=0;const r=8,E=[6,19,20,10,56,59];for(let o=-r;o<=r;o++)for(let t=-r;t<=r;t++)if(t*t+o*o<=r*r&&e()<.5){const f=l+t,c=T+o;f>=0&&f<L&&c>=0&&c<Y&&n[i(f,c)]===0&&(n[i(f,c)]=E[Math.floor(e()*E.length)])}}}else{n[M]=0;const P=7,r=[6,19,20,10,56,59];for(let E=-P;E<=P;E++)for(let o=-P;o<=P;o++)if(o*o+E*E<=P*P&&e()<.45){const t=l+o,f=T+E;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=r[Math.floor(e()*r.length)])}}else if(a===55){let P=!1;for(let r=0;r<3;r++){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1,t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=n[i(t,f)];if(c===2||c===41||c===28||c===52){P=!0;break}}}if(P){if(T>0&&e()<.6){const r=i(l,T-1),E=n[r];if(E===2||E===41||E===28||E===52)n[r]=55,n[M]=E;else if(E===0){n[M]=0;for(let o=0;o<3;o++){const t=l+Math.floor(e()*3)-1,f=T-1-Math.floor(e()*2);t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=2)}}}if(e()<.2){const r=e()<.5?-1:1;if(l+r>=0&&l+r<L){const E=i(l+r,T),o=n[E];(o===2||o===41||o===28||o===52)&&(n[E]=55,n[M]=o)}}}else n[M]=7}else if(a===58){const P=e()<.8?-2:-1,r=Math.floor(e()*3)-1;let E=!1;for(let o=Math.abs(P);o>0;o--){const t=T-o,f=l+(o===Math.abs(P)?r:0);if(t>=0&&t<Y&&f>=0&&f<L){const c=i(f,t),s=n[c];if(s===0){n[c]=58,n[M]=59,E=!0;break}else if(s===2){n[c]=7,n[M]=59,E=!0;break}else if(s===5||s===8||s===26){n[c]=59,n[M]=59,E=!0;break}else if(s===1){n[c]=12,n[M]=59,E=!0;break}else{n[M]=0;for(let A=-2;A<=2;A++)for(let R=-2;R<=2;R++){const I=l+R,S=T+A;I>=0&&I<L&&S>=0&&S<Y&&n[i(I,S)]===0&&(n[i(I,S)]=e()<.6?59:19)}E=!0;break}}}(!E||e()<.05)&&(n[M]=59)}else if(a===10){if(T===0){n[M]=0;continue}if(e()<.08){n[M]=0;continue}for(let r=0;r<3;r++){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1;if(E===0&&o===0)continue;const t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=n[i(t,f)];c===1&&e()<.5?n[i(t,f)]=10:(c===5||c===8||c===7||c===26)&&e()<.5&&(n[i(t,f)]=6)}}const P=i(l,T-1);if(T>0&&n[P]===0)n[P]=10,n[M]=0;else{const r=e()<.5?-1:1;T>0&&l+r>=0&&l+r<L&&n[i(l+r,T-1)]===0&&(n[i(l+r,T-1)]=10,n[M]=0)}}else if(a===13){if(e()<.2){n[M]=e()<.2?20:0;continue}let P=!1;for(let r=1;r<=3&&!P;r++){const E=T+r;if(E>=Y)break;const o=i(l,E),t=n[o];if(t===1){n[o]=12,n[M]=0,P=!0;for(let f=0;f<3;f++){let c=l,s=E,A=e()<.5?-1:1;for(let R=0;R<8&&(e()<.3&&(A=e()<.5?-1:1),c+=A,s+=e()<.8?1:0,!(c<0||c>=L||s>=Y));R++){const I=i(c,s);if(n[I]===1)n[I]=12;else if(n[I]!==0&&n[I]!==12)break}}}else if(t===2){n[o]=13,n[M]=0,P=!0;for(let f=-3;f<=3;f++){const c=l+f;c>=0&&c<L&&n[i(c,E)]===2&&e()<.7&&(n[i(c,E)]=13)}}else if(t===5||t===8||t===9)n[o]=6,n[M]=0,P=!0;else if(t===11){n[M]=0;const f=15;for(let c=-f;c<=f;c++)for(let s=-f;s<=f;s++)if(s*s+c*c<=f*f){const A=l+s,R=E+c;if(A>=0&&A<L&&R>=0&&R<Y){const I=i(A,R),S=n[I];S===2?n[I]=e()<.7?4:0:S!==4&&S!==12&&(n[I]=6)}}P=!0}else if(t===4||t===12)n[M]=0,P=!0;else if(t===3)e()<.4&&(n[o]=12),n[M]=0,P=!0;else{if(t===0)continue;n[M]=0,P=!0}}if(!P&&T+1<Y&&n[i(l,T+1)]===0){if(n[i(l,T+1)]=13,n[M]=0,e()<.15){const r=l+(e()<.5?-1:1);r>=0&&r<L&&n[i(r,T)]===0&&(n[i(r,T)]=13)}}else P||(n[M]=0)}else if(a===21){let P=!1;for(let s=0;s<2;s++){const A=Math.floor(e()*3)-1,R=Math.floor(e()*3)-1;if(A===0&&R===0)continue;const I=l+A,S=T+R;if(I>=0&&I<L&&S>=0&&S<Y){const N=n[i(I,S)];if(N===6||N===10||N===13||N===19){n[M]=6;for(let U=0;U<4;U++){const O=l+Math.floor(e()*3)-1,u=T+Math.floor(e()*3)-1;O>=0&&O<L&&u>=0&&u<Y&&n[i(O,u)]===0&&e()<.5&&(n[i(O,u)]=6)}P=!0;break}if(N===16||N===17){n[M]=0,P=!0;break}}}if(P)continue;if(e()<.003){n[M]=8;continue}if(e()<.4)continue;const r=e(),E=e();let o=0,t=0;if(r<.5?(t=-1,o=E<.35?-1:E<.7?1:0):r<.75?(o=E<.5?-2:2,t=E<.4?-1:0):r<.9&&(t=1,o=E<.5?-1:1),o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=i(f,c),A=n[s];A===15||A===9||A===25?(n[s]=21,n[M]=e()<.6?21:5):(A===0||A===8)&&(n[s]=21,n[M]=0)}}else if(a===25){let P=!1;for(let s=0;s<2;s++){const A=Math.floor(e()*3)-1,R=Math.floor(e()*3)-1;if(A===0&&R===0)continue;const I=l+A,S=T+R;if(I>=0&&I<L&&S>=0&&S<Y){const N=n[i(I,S)];if(N===6||N===10||N===13||N===19){n[M]=6,P=!0;break}}}if(P)continue;const r=e(),E=e();let o=0,t=0;if(r<.3?(t=-1,o=E<.4?-1:E<.8?1:0):r<.5?(t=1,o=E<.4?-1:E<.8?1:0):r<.8&&(o=E<.5?-1:1,t=E<.3?-1:E<.6?1:0),o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=i(f,c),A=n[s];if(A===5){if(e()<.08)for(let R=-1;R<=1;R++)for(let I=-1;I<=1;I++){if(R===0&&I===0)continue;const S=f+I,N=c+R;if(S>=0&&S<L&&N>=0&&N<Y&&n[i(S,N)]===0){n[i(S,N)]=26;break}}}else A===0?(n[s]=25,n[M]=0):A===26&&(n[s]=25,n[M]=e()<.1?28:e()<.15?0:26)}}else if(a===61){let P=!1;for(let c=0;c<2;c++){const s=Math.floor(e()*3)-1,A=Math.floor(e()*3)-1;if(s===0&&A===0)continue;const R=l+s,I=T+A;if(R>=0&&R<L&&I>=0&&I<Y){const S=n[i(R,I)];if(S===6||S===10||S===42){n[M]=6,P=!0;break}if(S===2||S===41){n[M]=0,P=!0;break}if(S===21){n[M]=0,P=!0;break}}}if(P)continue;if(e()<.15){const c=Math.floor(e()*3)-1,s=Math.floor(e()*3)-1,A=l+c,R=T+s;A>=0&&A<L&&R>=0&&R<Y&&n[i(A,R)]===0&&(n[i(A,R)]=e()<.7?56:20)}if(e()<.5)continue;let r={x:0,y:0};for(let c=0;c<3;c++){const s=Math.floor(e()*9)-4,A=Math.floor(e()*9)-4,R=l+s,I=T+A;if(R>=0&&R<L&&I>=0&&I<Y&&n[i(R,I)]===26){r={x:Math.sign(s),y:Math.sign(A)};break}}let E=0,o=0;if(r.x!==0||r.y!==0)E=r.x,o=r.y;else{const c=e();c<.25?(o=-1,E=e()<.5?-1:1):c<.4?(o=1,E=e()<.5?-1:1):c<.7&&(E=e()<.5?-1:1)}if(E===0&&o===0)continue;const t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];if(s===0)n[c]=61,n[M]=0;else if(s===26&&e()<.03){const A=l+Math.floor(e()*3)-1,R=T+Math.floor(e()*3)-1;A>=0&&A<L&&R>=0&&R<Y&&n[i(A,R)]===0&&(n[i(A,R)]=61)}}}}}}for(let T=Y-2;T>=0;T--){const d=e()<.5;for(let x=0;x<L;x++){const l=d?x:L-1-x,M=i(l,T),a=n[M];if(a===0)continue;const P=i(l,T+1),r=n[P];if(a===35||a===34||a===36){const E=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],o=a-31,[t,f]=E[o];if(t!==0&&t>0===d)continue;const c=l+t,s=T+f;if(c<0||c>=L||s<0||s>=Y){n[M]=39;continue}const A=i(c,s),R=n[A];if(R===22||R===11){n[A]=6,n[M]=39;continue}if(R===9||R===15||R===21||R===25||R===14){n[A]=a,n[M]=39;continue}if(R===2){if(e()<.15)n[M]=39;else{if(e()<.5)continue;n[A]=a,n[M]=39}continue}if(R===30){const I=c+t,S=s+f;I>=0&&I<L&&S>=0&&S<Y&&n[i(I,S)]===0&&(n[i(I,S)]=a),n[M]=39;continue}if(R===46){const I=[35,36,37,38,31,32,33,34];n[M]=I[a-31];continue}if(R===5||R===26||R===12||R===8||R===7||R>=31&&R<=38||R===39){n[A]=a,n[M]=39;continue}if(R===4||R===3||R===1){e()<.2||(n[A]=a),n[M]=39;continue}if(R===0){n[A]=a,n[M]=39;continue}n[M]=39;continue}if(a===39){e()<.3&&(n[M]=0);continue}if(a===23){T<Y-1&&n[P]===0&&e()<.15&&(n[P]=2);continue}if(a===24){if(e()<.03){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1,t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=15)}continue}if(a===27){if(e()<.015){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1,t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=25)}continue}if(a===29){if(e()<.008){const E=Math.floor(e()*3)-1,o=-1,t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=21)}continue}if(a===30){if(e()<.08){const E=[31,32,33,34,35,36,37,38],o=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(let t=0;t<8;t++){const[f,c]=o[t],s=l+f,A=T+c;if(s>=0&&s<L&&A>=0&&A<Y&&n[i(s,A)]===0){n[i(s,A)]=E[t];break}}}continue}if(a===1)if(r===0)n[P]=1,n[M]=0;else if(r===2||r===41)n[P]=1,n[M]=r;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=1,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0&&(n[i(t,T+1)]=1,n[M]=0)}else if(a===2)if(r===0)n[P]=2,n[M]=0;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=2,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=2,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0?(n[i(o,T)]=2,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&(n[i(t,T)]=2,n[M]=0)}else if(a===3)r===0?(n[P]=3,n[M]=0):r===2&&(n[P]=3,n[M]=2);else if(a===8){if(e()<.3&&r===0)n[P]=8,n[M]=0;else if(e()<.15){const E=e()<.5?-1:1;l+E>=0&&l+E<L&&n[i(l+E,T+1)]===0&&(n[i(l+E,T+1)]=8,n[M]=0)}}else if(a===9){if(e()<.5)continue;const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1;if(E===0&&o===0)continue;const t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];s===6||s===10||s===13||s===19?n[M]=6:s===5?(n[c]=9,n[M]=e()<.3?0:3):(s===0||s===2)&&(n[c]=9,n[M]=0)}}else if(a===11){for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];if(s===6||s===10||s===19||s===42){for(let R=-12;R<=12;R++)for(let I=-12;I<=12;I++)if(I*I+R*R<=144){const S=l+I,N=T+R;if(S>=0&&S<L&&N>=0&&N<Y){const U=i(S,N),O=n[U];O===2?n[U]=e()<.7?4:0:O!==4&&O!==12&&(n[U]=6)}}break}}}if(n[M]!==11)continue;if(r===0)n[P]=11,n[M]=0;else if(r===2)n[P]=11,n[M]=2;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=11,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=11,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0?(n[i(o,T)]=11,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&(n[i(t,T)]=11,n[M]=0)}}else if(a===14){for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];if(s===6||s===10||s===19||s===42){n[M]=7;break}}}if(n[M]!==14||e()<.6)continue;if(r===0)n[P]=14,n[M]=0;else{const E=e()<.5?-1:1,o=l+E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=14,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0&&e()<.3&&(n[i(o,T)]=14,n[M]=0)}}else if(a===15){let E=!1;for(let s=0;s<2;s++){const A=Math.floor(e()*3)-1,R=Math.floor(e()*3)-1;if(A===0&&R===0)continue;const I=l+A,S=T+R;if(I>=0&&I<L&&S>=0&&S<Y){const N=n[i(I,S)];if(N===6||N===10||N===13||N===19||N===42){n[M]=6,E=!0;break}if(N===2||N===41){n[M]=0,E=!0;break}}}if(E||e()<.5)continue;const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=i(f,c),A=n[s];A===3||A===1||A===0?(n[s]=15,n[M]=0):(A===5||A===26)&&(n[s]=15,n[M]=e()<.5?0:3)}}else if(a===16){if(e()<.6)continue;const E=Math.floor(e()*5)-2,o=Math.floor(e()*5)-2;if(E===0&&o===0)continue;const t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];s===0?(n[c]=16,n[M]=e()<.95?0:17):s===9||s===15||s===21||s===25||s===14?(n[c]=16,n[M]=e()<.7?16:17):s===5||s===26?(n[c]=16,n[M]=17):(s===6||s===10||s===13)&&(n[M]=17)}}else if(a===17){if(e()<.03){n[M]=e()<.33?18:e()<.5?19:20;continue}const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1;if(E===0&&o===0)continue;const t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=17,n[M]=0)}else if(a===18)r===0&&e()<.5?(n[P]=18,n[M]=0):r===2&&(n[P]=18,n[M]=2);else if(a===19){if(e()<.05){n[M]=e()<.3?6:0;continue}for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];(s===5||s===8||s===7||s===26)&&e()<.4&&(n[i(f,c)]=6)}}if(r===0)n[P]=19,n[M]=0;else{const E=e()<.5?-1:1;l+E>=0&&l+E<L&&n[i(l+E,T+1)]===0&&(n[i(l+E,T+1)]=19,n[M]=0)}}else if(a===20){if(e()<.08){n[M]=0;continue}const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1;if(E!==0||o!==0){const t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=20,n[M]=0)}}else if(a===22){for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];if(s===6||s===10||s===19||s===42){for(let R=-6;R<=6;R++)for(let I=-6;I<=6;I++)if(I*I+R*R<=36){const S=l+I,N=T+R;if(S>=0&&S<L&&N>=0&&N<Y){const U=i(S,N),O=n[U];O!==4&&O!==12&&O!==2&&(n[U]=6)}}break}}}if(n[M]!==22)continue;if(r===0)n[P]=22,n[M]=0;else if(r===2)n[P]=22,n[M]=2;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=22,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0&&(n[i(t,T+1)]=22,n[M]=0)}}else if(a===28){if(e()>.15)continue;if(r===0)n[P]=28,n[M]=0;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=28,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=28,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0&&e()<.3?(n[i(o,T)]=28,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&e()<.3&&(n[i(t,T)]=28,n[M]=0)}}else if(a===41){let E=!1;for(let o=0;o<3;o++){const t=Math.floor(e()*3)-1,f=Math.floor(e()*3)-1;if(t===0&&f===0)continue;const c=l+t,s=T+f;if(c>=0&&c<L&&s>=0&&s<Y){const A=i(c,s),R=n[A];if((R===5||R===3||R===1||R===8||R===26||R===14)&&e()<.3){n[A]=e()<.7?0:7,e()<.4&&(n[M]=0,E=!0);break}if((R===4||R===12||R===18)&&e()<.08){n[A]=0,n[M]=0,E=!0;break}if((R===9||R===15||R===21||R===25)&&e()<.5){n[A]=41;break}}}if(E)continue;if(r===0)n[P]=41,n[M]=0;else{const o=e()<.5?-1:1,t=l+o,f=l-o;t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=41,n[M]=0):f>=0&&f<L&&n[i(f,T+1)]===0?(n[i(f,T+1)]=41,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0?(n[i(t,T)]=41,n[M]=0):f>=0&&f<L&&n[i(f,T)]===0&&(n[i(f,T)]=41,n[M]=0)}}else if(a===42){for(let E=0;E<3;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=i(f,c),A=n[s];if(A===2){if(n[s]=e()<.5?4:7,e()<.15){n[M]=4;break}}else A===43?n[s]=2:A===1&&e()<.4?n[s]=12:((A===5||A===8||A===7||A===26||A===22||A===27||A===29)&&e()<.7||(A===9||A===15||A===21||A===25)&&e()<.8)&&(n[s]=6)}}if(e()<.001){n[M]=4;continue}if(e()>.15)continue;if(r===0)n[P]=42,n[M]=0;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=42,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=42,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0&&e()<.3?(n[i(o,T)]=42,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&e()<.3&&(n[i(t,T)]=42,n[M]=0)}}else if(a===43){let E=!1;if(e()<.4)for(let o=-1;o<=1&&!E;o++)for(let t=-1;t<=1&&!E;t++){if(o===0&&t===0)continue;const f=l+t,c=T+o;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];(s===6||s===10||s===19||s===42)&&e()<.6?(n[M]=2,E=!0):s===2&&e()<.04&&(n[i(f,c)]=12)}}if(E)continue;if(e()<.25&&r===0)n[P]=43,n[M]=0;else if(e()<.1){const o=e()<.5?-1:1;l+o>=0&&l+o<L&&n[i(l+o,T+1)]===0&&(n[i(l+o,T+1)]=43,n[M]=0)}}else if(a===44){for(let E=0;E<3;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];if(s===2){if(n[i(f,c)]=7,e()<.08){n[M]=4;continue}}else s===43&&(n[i(f,c)]=2)}}if(n[M]===4)continue;if(e()<.35&&T>0){const E=i(l,T-1);n[E]===0&&(n[E]=42)}if(e()<.1){const E=e()<.5?-1:1;if(l+E>=0&&l+E<L&&T>0){const o=i(l+E,T-1);n[o]===0&&(n[o]=42)}}if(e()<.05){const E=Math.floor(e()*3)-1,o=Math.floor(e()*2)-1,t=l+E,f=T+o;t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=19)}}else if(a===45){if(e()<.008){n[M]=0;continue}for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];if(s===6||s===10||s===42||s===41){n[M]=s===41?0:6;break}}}if(n[M]===6||n[M]===0)continue;if(e()<.08){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1,t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];s===5||s===26||s===8||s===28||s===3?(n[c]=45,e()<.2&&(n[M]=e()<.4?50:7)):(s===9||s===15||s===14)&&e()<.3?n[c]=45:s===0&&e()<.1&&(n[c]=45,n[M]=e()<.3?7:0)}}}else if(a===46){for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];(s===9||s===15||s===21||s===25||s===14)&&e()<.5&&(n[i(f,c)]=0)}}if(r===0)n[P]=46,n[M]=0;else if(r===2||r===41||r===28||r===1||r===3)e()<.7&&(n[P]=46,n[M]=r);else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=46,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=46,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0?(n[i(o,T)]=46,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&(n[i(t,T)]=46,n[M]=0)}}else if(a===47){if(e()<.003){n[M]=0;continue}for(let E=0;E<2;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y&&n[i(f,c)]===13){n[M]=20;break}}if(n[M]===20)continue;if(e()<.1){const E=Math.floor(e()*3)-1,o=Math.floor(e()*3)-1,t=l+E,f=T+o;if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];if(s!==0&&s!==4&&s!==12&&s!==18&&s!==47&&s!==23&&s!==44&&(n[c]=0,e()<.02)){const A=l+Math.floor(e()*3)-1,R=T+Math.floor(e()*3)-1;A>=0&&A<L&&R>=0&&R<Y&&n[i(A,R)]===0&&(n[i(A,R)]=47)}}}}else if(a===48){if(r===0){n[P]=48,n[M]=0;continue}else if(r===2&&e()<.5){n[P]=48,n[M]=2;continue}const E=Math.floor(e()*8),o=[0,1,1,1,0,-1,-1,-1][E],t=[-1,-1,0,1,1,1,0,-1][E],f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const u=n[i(f,c)];if(u===6||u===10||u===42){n[M]=6;continue}if((u===9||u===15||u===21)&&e()<.3){n[M]=0;continue}}if(e()>.35)continue;const s=T>0?n[i(l,T-1)]:0;if(!(T<Y-1&&(n[P]===3||n[P]===2)||s===3||s===2||s===5))continue;let R=!1,I=!1;for(let u=0;u<6;u++){const B=Math.floor(e()*13)-6,nn=Math.floor(e()*13)-6,k=l+B,H=T+nn;if(k>=0&&k<L&&H>=0&&H<Y){const q=n[i(k,H)];q===2&&(R=!0),q===57&&(I=!0)}}const S=I?.7:R?.5:.25;if(e()>S)continue;const N=I?50:R?30:20;let U=-1;for(let u=1;u<=N&&!(T-u<0);u++){const B=n[i(l,T-u)];if(B===0){U=T-u;break}if(B!==5&&B!==26&&B!==2&&B!==3&&B!==48)break}if(U>=0){const u=I?.3:R?.15:.1;n[i(l,U)]=e()<u?26:5}const O=T-(U>=0?U:T);if(O>10&&e()<(I?.2:.1)){const u=l+(e()<.5?-1:1),B=T-Math.floor(e()*Math.min(O,15))-5;u>=0&&u<L&&B>=0&&n[i(u,B)]===0&&(n[i(u,B)]=e()<.4?26:5)}}else if(a===49){if(e()<.005){n[M]=3;continue}let E=!1;for(let o=0;o<2;o++){const t=Math.floor(e()*3)-1,f=Math.floor(e()*3)-1,c=l+t,s=T+f;if(c>=0&&c<L&&s>=0&&s<Y&&n[i(c,s)]===2){E=!0;break}}if(E&&e()<.03){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1,f=l+o,c=T+t;f>=0&&f<L&&c>=0&&c<Y&&n[i(f,c)]===4&&(n[i(f,c)]=49)}r===0&&e()<.1&&(n[P]=49,n[M]=0)}else if(a===51){let E=!1;if((T>0&&n[i(l,T-1)]===2||T<Y-1&&n[i(l,T+1)]===2||l>0&&n[i(l-1,T)]===2||l<L-1&&n[i(l+1,T)]===2)&&(E=!0),!E&&e()<.008){n[M]=5;continue}if(E&&e()<.01&&T>0){const o=i(l,T-1);n[o]===2&&(n[o]=7)}if(E&&e()<.02){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1,f=l+o,c=T+t;f>=0&&f<L&&c>=0&&c<Y&&n[i(f,c)]===2&&(n[i(f,c)]=51)}for(let o=0;o<2;o++){const t=Math.floor(e()*3)-1,f=Math.floor(e()*3)-1;if(t===0&&f===0)continue;const c=l+t,s=T+f;if(c>=0&&c<L&&s>=0&&s<Y){const A=n[i(c,s)];if((A===9||A===14)&&e()<.25){n[M]=0;break}}}}else if(a===52){for(let E=0;E<3;E++){const o=Math.floor(e()*3)-1,t=Math.floor(e()*3)-1;if(o===0&&t===0)continue;const f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=n[i(f,c)];(s===9||s===15||s===21||s===25||s===14)&&e()<.5||s===51&&e()<.08||s===5&&e()<.05?n[i(f,c)]=52:s===2&&e()<.15&&(n[i(f,c)]=0,e()<.5&&(n[M]=2))}}if(e()>.3)continue;if(r===0)n[P]=52,n[M]=0;else{const E=e()<.5?-1:1,o=l+E,t=l-E;o>=0&&o<L&&n[i(o,T+1)]===0?(n[i(o,T+1)]=52,n[M]=0):t>=0&&t<L&&n[i(t,T+1)]===0?(n[i(t,T+1)]=52,n[M]=0):o>=0&&o<L&&n[i(o,T)]===0?(n[i(o,T)]=52,n[M]=0):t>=0&&t<L&&n[i(t,T)]===0&&(n[i(t,T)]=52,n[M]=0)}}else if(a===53){let E=!1;for(let o=0;o<2;o++){const t=Math.floor(e()*3)-1,f=Math.floor(e()*3)-1;if(t===0&&f===0)continue;const c=l+t,s=T+f;if(c>=0&&c<L&&s>=0&&s<Y){const A=n[i(c,s)];if(A===6||A===10||A===19||A===42){n[M]=6;for(let R=0;R<10;R++){const I=Math.floor(e()*5)-2,S=Math.floor(e()*5)-2,N=l+I,U=T+S;N>=0&&N<L&&U>=0&&U<Y&&n[i(N,U)]===53&&e()<.8&&(n[i(N,U)]=6)}E=!0;break}}}if(E)continue;if(e()<.003){n[M]=1;continue}if(e()<.3){const o=Math.floor(e()*3)-1,t=e()<.6?1:e()<.5?0:-1,f=l+o,c=T+t;f>=0&&f<L&&c>=0&&c<Y&&n[i(f,c)]===0&&(n[i(f,c)]=53,n[M]=0)}}else if(a===56){let E=0;for(let t=0;t<3;t++){const f=Math.floor(e()*3)-1,c=Math.floor(e()*3)-1;if(f===0&&c===0)continue;const s=l+f,A=T+c;s>=0&&s<L&&A>=0&&A<Y&&n[i(s,A)]===56&&E++}const o=E===0?.15:E>0?.03:.01;if(e()<o){n[M]=0;continue}if(e()<.3)if(r===0)n[P]=56,n[M]=0;else{const t=e()<.5?-1:1;l+t>=0&&l+t<L&&n[i(l+t,T+1)]===0&&(n[i(l+t,T+1)]=56,n[M]=0)}}else if(a===57){if(e()<.12){const E=e()*6.28318,o=e()*4+1,t=l+Math.round(Math.cos(E)*o),f=T+Math.round(Math.sin(E)*o);t>=0&&t<L&&f>=0&&f<Y&&n[i(t,f)]===0&&(n[i(t,f)]=e()<.6?20:56)}if(e()<.04){const E=e()*6.28318,o=e()*12+3,t=l+Math.round(Math.cos(E)*o),f=T+Math.round(Math.sin(E)*o);if(t>=0&&t<L&&f>=0&&f<Y){const c=i(t,f),s=n[c];s===5&&e()<.3?n[c]=26:s===2&&e()<.1?n[c]=51:s===3&&e()<.15||s===0&&e()<.05?n[c]=5:s===43&&e()<.2?n[c]=2:s===45&&e()<.1&&(n[c]=26)}}if(e()<.02)for(let E=0;E<5;E++){const o=Math.floor(e()*5)-2,t=Math.floor(e()*5)-2,f=l+o,c=T+t;if(f>=0&&f<L&&c>=0&&c<Y){const s=i(f,c);n[s]===2&&(n[s]=7)}}}else if(a===60){if(e()>.5)continue;const E=10;for(let o=0;o<16;o++){const t=e()*6.28318,f=e()*E+1,c=Math.round(Math.cos(t)*f),s=Math.round(Math.sin(t)*f);if(c===0&&s===0)continue;const A=l+c,R=T+s;if(A<0||A>=L||R<0||R>=Y)continue;const I=i(A,R),S=n[I];if(S===0||S===60||S===23||S===44||S===30||S===24||S===27)continue;const N=c>0?-1:c<0?1:0,U=s>0?-1:s<0?1:0,O=A+N,u=R+U;if(O>=0&&O<L&&u>=0&&u<Y){const B=i(O,u);Math.abs(c+N)<=1&&Math.abs(s+U)<=1?n[I]=0:n[B]===0&&(n[B]=S,n[I]=0)}}for(let o=-6;o<=6;o+=2){const t=l+o;if(!(t<0||t>=L))for(let f=-8;f<=2;f+=2){const c=T+f;if(c<0||c>=Y)continue;const s=i(t,c),A=n[s];if(!(A===0||A===60)&&Math.abs(o)>1&&e()<.3){const R=o>0?-1:1,I=t+R;I>=0&&I<L&&n[i(I,c)]===0&&(n[i(I,c)]=A,n[s]=0)}}}}}}}function $(){if(!F||!W||!y)return;const n=h,e=y.width,i=new Uint32Array(W.data.buffer);i.fill(Z);const T=_;for(let d=0;d<Y;d++){const x=d*L,l=d*T*e;for(let M=0;M<L;M++){const a=n[x+M];if(a===0)continue;let P;a===6?P=m[M+d&31]:a===10?P=v[M+d&63]:a===13?P=p[M+d&31]:a===59?P=w[M+d&31]:P=j[a];const r=M*T,E=l+r,o=E+e,t=o+e,f=t+e;i[E]=i[E+1]=i[E+2]=i[E+3]=P,i[o]=i[o+1]=i[o+2]=i[o+3]=P,i[t]=i[t+1]=i[t+2]=i[t+3]=P,i[f]=i[f+1]=i[f+2]=i[f+3]=P}}F.putImageData(W,0,0)}let G=0,b=0;const g=1e3/60;function Q(n){G===0&&(G=n);const e=Math.min(n-G,100);G=n;for(const i of C)z(i.x,i.y,i.tool,i.brushSize);C=[],V||(b+=e,b>=g&&(J(),b=Math.min(b-g,g))),$(),requestAnimationFrame(Q)}self.onmessage=n=>{const{type:e,data:i}=n.data;switch(e){case"init":y=n.data.canvas,F=y.getContext("2d",{willReadFrequently:!1}),K(y.width,y.height),G=0,b=0,requestAnimationFrame(Q);break;case"resize":y&&(y.width=i.width,y.height=i.height,K(i.width,i.height));break;case"input":C.push({x:i.cellX,y:i.cellY,tool:i.tool,brushSize:i.brushSize});break;case"pause":V=i.paused;break;case"reset":h.fill(0);break}}})();
