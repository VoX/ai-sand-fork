(function(){"use strict";const Z={sand:1,water:2,dirt:3,stone:4,plant:5,fire:6,gas:7,fluff:8,bug:9,plasma:10,nitro:11,glass:12,lightning:13,slime:14,ant:15,alien:16,quark:17,crystal:18,ember:19,static:20,bird:21,gunpowder:22,tap:23,anthill:24,bee:25,flower:26,hive:27,honey:28,nest:29,gun:30,cloud:40,acid:41,lava:42,snow:43,volcano:44,mold:45,mercury:46,void:47,seed:48,rust:49,spore:50,algae:51,poison:52,dust:53,firework:54,bubble:55,glitter:56,star:57,comet:58,blackhole:60,firefly:61,worm:62,fairy:63},g=4;function b(n,t,i){t/=100,i/=100;const c=t*Math.min(i,1-i),S=u=>{const l=(u+n/30)%12;return i-c*Math.max(Math.min(l-3,9-l,1),-1)};return 255<<24|Math.round(S(4)*255)<<16|Math.round(S(8)*255)<<8|Math.round(S(0)*255)}const z=new Uint32Array([4279900698,4285450470,4292448330,4281031307,4284900966,4280453922,0,4287137928,4292077301,4290013695,0,4279566137,4293580968,0,4281519514,4279904875,4278255360,4294902015,4294955136,4280303871,4294967108,4293454056,4281348144,4290822336,4281368752,4278245631,4294919372,4282431720,4281377023,4286611616,4283453520,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282712063,4282703359,4292399304,4278255551,4279506140,4294963424,4278190182,4293814395,4291346616,4283697198,4285834708,4279124407,4289376800,4282216485,4287299723,4287084766,4278216447,4293643911,4290822336,4278247423,4294965629,4294938654,4278190080,4278255551,4286615744,4294936831]),p=new Uint32Array(32),v=new Uint32Array(64),V=new Uint32Array(32),K=new Uint32Array(32);for(let n=0;n<32;n++)p[n]=b(10+n,100,50+n/32*20),V[n]=b(50+n/32*20,100,80+n/32*20),K[n]=b(200+n/32*20,100,50+n/32*30);for(let n=0;n<64;n++)v[n]=b(n<32?280+n:320+(n-32),100,60+n/64*25);const J=4279900698;let F=null,W=null,_=null,h=new Uint8Array(0),L=0,Y=0,q=!1,H=[];function Q(n,t){L=Math.floor(n/g),Y=Math.floor(t/g),h=new Uint8Array(L*Y),W&&(_=W.createImageData(n,t))}function $(n,t,i,c){const S=i==="erase"?0:Z[i];if(S===30){if(n>=0&&n<L&&t>=0&&t<Y){const u=t*L+n;h[u]!==4&&h[u]!==23&&h[u]!==30&&h[u]!==60&&(h[u]=30)}return}for(let u=-c;u<=c;u++)for(let l=-c;l<=c;l++)if(l*l+u*u<=c*c){const M=n+l,a=t+u;if(M>=0&&M<L&&a>=0&&a<Y){const P=a*L+M;let R=.3;S===21||S===25||S===61?R=.8:S===15||S===9||S===14?R=.7:S===16||S===17?R=.92:(S===45||S===50)&&(R=.6),(i==="erase"||Math.random()>R)&&(i==="erase"||h[P]!==4&&h[P]!==23&&h[P]!==60)&&(h[P]=S)}}}function nn(){const n=h,t=Math.random,i=(c,S)=>S*L+c;for(let c=0;c<Y;c++){const S=t()<.5;for(let u=0;u<L;u++){const l=S?u:L-1-u,M=i(l,c),a=n[M];if(a!==0){if(a>=31&&a<=38){const P=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],R=a-31,[E,o]=P[R];if(o>0||E!==0&&E>0===S)continue;const e=l+E,f=c+o;if(e<0||e>=L||f<0||f>=Y){n[M]=39;continue}const T=i(e,f),s=n[T];if(s===22||s===11){n[T]=6,n[M]=39;continue}if(s===9||s===15||s===21||s===25||s===14){n[T]=a,n[M]=39;continue}if(s===2){if(t()<.15)n[M]=39;else{if(t()<.5)continue;n[T]=a,n[M]=39}continue}if(s===30){const r=e+E,A=f+o;if(r>=0&&r<L&&A>=0&&A<Y){const I=i(r,A);n[I]===0&&(n[I]=a)}n[M]=39;continue}if(s===46){const r=[35,36,37,38,31,32,33,34];n[M]=r[a-31];continue}if(s===5||s===26||s===12||s===8||s===7||s>=31&&s<=38||s===39){n[T]=a,n[M]=39;continue}if(s===4||s===3||s===1){t()<.2||(n[T]=a),n[M]=39;continue}if(s===0){n[T]=a,n[M]=39;continue}n[M]=39;continue}if(a===6||a===59){if(c===0){n[M]=0;continue}if(t()<.1){n[M]=t()<.25?7:t()<.15?19:0;continue}for(let R=0;R<3;R++){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];(s===5||s===8||s===9||s===7||s===22||s===26||s===27||s===29)&&t()<.5&&(n[T]=6)}}const P=i(l,c-1);if(c>0&&n[P]===0)n[P]=a,n[M]=0;else{const R=t()<.5?-1:1;c>0&&l+R>=0&&l+R<L&&n[i(l+R,c-1)]===0&&(n[i(l+R,c-1)]=a,n[M]=0)}}else if(a===7){if(c===0){n[M]=0;continue}if(t()<.02){n[M]=0;continue}const P=i(l,c-1);if(c>0&&n[P]===0)n[P]=7,n[M]=0;else{const R=t()<.5?-1:1;c>0&&l+R>=0&&l+R<L&&n[i(l+R,c-1)]===0?(n[i(l+R,c-1)]=7,n[M]=0):l+R>=0&&l+R<L&&n[i(l+R,c)]===0&&(n[i(l+R,c)]=7,n[M]=0)}}else if(a===50){if(t()<.01){n[M]=0;continue}for(let P=0;P<3;P++){const R=Math.floor(t()*3)-1,E=Math.floor(t()*3)-1;if(R===0&&E===0)continue;const o=l+R,e=c+E;if(o>=0&&o<L&&e>=0&&e<Y){const f=n[i(o,e)];if((f===5||f===26||f===8||f===28||f===3||f===51)&&t()<.35){n[i(o,e)]=45,n[M]=0;break}}}if(t()<.4){const P=Math.floor(t()*3)-1,R=t()<.6?-1:t()<.5?0:1,E=l+P,o=c+R;E>=0&&E<L&&o>=0&&o<Y&&n[i(E,o)]===0&&(n[i(E,o)]=50,n[M]=0)}}else if(a===40){if(c<Y-1&&n[i(l,c+1)]===0&&t()<.04&&(n[i(l,c+1)]=2),t()<.3){const P=t()<.5?-1:1,R=t()<.3?-1:t()<.5?1:0,E=l+P,o=c+R;E>=0&&E<L&&o>=0&&o<Y&&n[i(E,o)]===0&&(n[i(E,o)]=40,n[M]=0)}}else if(a===54)if(c>0&&t()<.95){const P=i(l,c-1);if(n[P]===0)n[P]=54,n[M]=0;else{n[M]=0;const R=8,E=[6,19,20,10,56,59];for(let o=-R;o<=R;o++)for(let e=-R;e<=R;e++)if(e*e+o*o<=R*R&&t()<.5){const f=l+e,T=c+o;f>=0&&f<L&&T>=0&&T<Y&&n[i(f,T)]===0&&(n[i(f,T)]=E[Math.floor(t()*E.length)])}}}else{n[M]=0;const P=7,R=[6,19,20,10,56,59];for(let E=-P;E<=P;E++)for(let o=-P;o<=P;o++)if(o*o+E*E<=P*P&&t()<.45){const e=l+o,f=c+E;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=R[Math.floor(t()*R.length)])}}else if(a===55){let P=!1;for(let R=0;R<3;R++){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=n[i(e,f)];if(T===2||T===41||T===28||T===52){P=!0;break}}}if(P){if(c>0&&t()<.6){const R=i(l,c-1),E=n[R];if(E===2||E===41||E===28||E===52)n[R]=55,n[M]=E;else if(E===0){n[M]=0;for(let o=0;o<3;o++){const e=l+Math.floor(t()*3)-1,f=c-1-Math.floor(t()*2);e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=2)}}}if(t()<.2){const R=t()<.5?-1:1;if(l+R>=0&&l+R<L){const E=i(l+R,c),o=n[E];(o===2||o===41||o===28||o===52)&&(n[E]=55,n[M]=o)}}}else n[M]=7}else if(a===58){const P=t()<.8?-2:-1,R=Math.floor(t()*3)-1;let E=!1;for(let o=Math.abs(P);o>0;o--){const e=c-o,f=l+(o===Math.abs(P)?R:0);if(e>=0&&e<Y&&f>=0&&f<L){const T=i(f,e),s=n[T];if(s===0){n[T]=58,n[M]=59,E=!0;break}else if(s===2){n[T]=7,n[M]=59,E=!0;break}else if(s===5||s===8||s===26){n[T]=59,n[M]=59,E=!0;break}else if(s===1){n[T]=12,n[M]=59,E=!0;break}else{n[M]=0;for(let r=-2;r<=2;r++)for(let A=-2;A<=2;A++){const I=l+A,N=c+r;I>=0&&I<L&&N>=0&&N<Y&&n[i(I,N)]===0&&(n[i(I,N)]=t()<.6?59:19)}E=!0;break}}}(!E||t()<.05)&&(n[M]=59)}else if(a===10){if(c===0){n[M]=0;continue}if(t()<.08){n[M]=0;continue}for(let R=0;R<3;R++){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=n[i(e,f)];T===1&&t()<.5?n[i(e,f)]=10:(T===5||T===8||T===7||T===26)&&t()<.5&&(n[i(e,f)]=6)}}const P=i(l,c-1);if(c>0&&n[P]===0)n[P]=10,n[M]=0;else{const R=t()<.5?-1:1;c>0&&l+R>=0&&l+R<L&&n[i(l+R,c-1)]===0&&(n[i(l+R,c-1)]=10,n[M]=0)}}else if(a===13){if(t()<.2){n[M]=t()<.2?20:0;continue}let P=!1;for(let R=1;R<=3&&!P;R++){const E=c+R;if(E>=Y)break;const o=i(l,E),e=n[o];if(e===1){n[o]=12,n[M]=0,P=!0;for(let f=0;f<3;f++){let T=l,s=E,r=t()<.5?-1:1;for(let A=0;A<8&&(t()<.3&&(r=t()<.5?-1:1),T+=r,s+=t()<.8?1:0,!(T<0||T>=L||s>=Y));A++){const I=i(T,s);if(n[I]===1)n[I]=12;else if(n[I]!==0&&n[I]!==12)break}}}else if(e===2){n[o]=13,n[M]=0,P=!0;for(let f=-3;f<=3;f++){const T=l+f;T>=0&&T<L&&n[i(T,E)]===2&&t()<.7&&(n[i(T,E)]=13)}}else if(e===5||e===8||e===9)n[o]=6,n[M]=0,P=!0;else if(e===11){n[M]=0;const f=15;for(let T=-f;T<=f;T++)for(let s=-f;s<=f;s++)if(s*s+T*T<=f*f){const r=l+s,A=E+T;if(r>=0&&r<L&&A>=0&&A<Y){const I=i(r,A),N=n[I];N===2?n[I]=t()<.7?4:0:N!==4&&N!==12&&(n[I]=6)}}P=!0}else if(e===4||e===12)n[M]=0,P=!0;else if(e===3)t()<.4&&(n[o]=12),n[M]=0,P=!0;else{if(e===0)continue;n[M]=0,P=!0}}if(!P&&c+1<Y&&n[i(l,c+1)]===0){if(n[i(l,c+1)]=13,n[M]=0,t()<.15){const R=l+(t()<.5?-1:1);R>=0&&R<L&&n[i(R,c)]===0&&(n[i(R,c)]=13)}}else P||(n[M]=0)}else if(a===21){let P=!1;for(let s=0;s<2;s++){const r=Math.floor(t()*3)-1,A=Math.floor(t()*3)-1;if(r===0&&A===0)continue;const I=l+r,N=c+A;if(I>=0&&I<L&&N>=0&&N<Y){const d=n[i(I,N)];if(d===6||d===10||d===13||d===19){n[M]=6;for(let U=0;U<4;U++){const O=l+Math.floor(t()*3)-1,y=c+Math.floor(t()*3)-1;O>=0&&O<L&&y>=0&&y<Y&&n[i(O,y)]===0&&t()<.5&&(n[i(O,y)]=6)}P=!0;break}if(d===16||d===17){n[M]=0,P=!0;break}}}if(P)continue;if(t()<.003){n[M]=8;continue}if(t()<.4)continue;const R=t(),E=t();let o=0,e=0;if(R<.5?(e=-1,o=E<.35?-1:E<.7?1:0):R<.75?(o=E<.5?-2:2,e=E<.4?-1:0):R<.9&&(e=1,o=E<.5?-1:1),o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=i(f,T),r=n[s];r===15||r===9||r===25?(n[s]=21,n[M]=t()<.6?21:5):(r===0||r===8)&&(n[s]=21,n[M]=0)}}else if(a===25){let P=!1;for(let s=0;s<2;s++){const r=Math.floor(t()*3)-1,A=Math.floor(t()*3)-1;if(r===0&&A===0)continue;const I=l+r,N=c+A;if(I>=0&&I<L&&N>=0&&N<Y){const d=n[i(I,N)];if(d===6||d===10||d===13||d===19){n[M]=6,P=!0;break}}}if(P)continue;const R=t(),E=t();let o=0,e=0;if(R<.3?(e=-1,o=E<.4?-1:E<.8?1:0):R<.5?(e=1,o=E<.4?-1:E<.8?1:0):R<.8&&(o=E<.5?-1:1,e=E<.3?-1:E<.6?1:0),o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=i(f,T),r=n[s];if(r===5){if(t()<.08)for(let A=-1;A<=1;A++)for(let I=-1;I<=1;I++){if(A===0&&I===0)continue;const N=f+I,d=T+A;if(N>=0&&N<L&&d>=0&&d<Y&&n[i(N,d)]===0){n[i(N,d)]=26;break}}}else r===0?(n[s]=25,n[M]=0):r===26&&(n[s]=25,n[M]=t()<.1?28:t()<.15?0:26)}}else if(a===61){let P=!1;for(let T=0;T<2;T++){const s=Math.floor(t()*3)-1,r=Math.floor(t()*3)-1;if(s===0&&r===0)continue;const A=l+s,I=c+r;if(A>=0&&A<L&&I>=0&&I<Y){const N=n[i(A,I)];if(N===6||N===10||N===42){n[M]=6,P=!0;break}if(N===2||N===41){n[M]=0,P=!0;break}if(N===21){n[M]=0,P=!0;break}}}if(P)continue;if(t()<.15){const T=Math.floor(t()*3)-1,s=Math.floor(t()*3)-1,r=l+T,A=c+s;r>=0&&r<L&&A>=0&&A<Y&&n[i(r,A)]===0&&(n[i(r,A)]=t()<.7?56:20)}if(t()<.5)continue;let R={x:0,y:0};for(let T=0;T<3;T++){const s=Math.floor(t()*9)-4,r=Math.floor(t()*9)-4,A=l+s,I=c+r;if(A>=0&&A<L&&I>=0&&I<Y&&n[i(A,I)]===26){R={x:Math.sign(s),y:Math.sign(r)};break}}let E=0,o=0;if(R.x!==0||R.y!==0)E=R.x,o=R.y;else{const T=t();T<.25?(o=-1,E=t()<.5?-1:1):T<.4?(o=1,E=t()<.5?-1:1):T<.7&&(E=t()<.5?-1:1)}if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];if(s===0)n[T]=61,n[M]=0;else if(s===26&&t()<.03){const r=l+Math.floor(t()*3)-1,A=c+Math.floor(t()*3)-1;r>=0&&r<L&&A>=0&&A<Y&&n[i(r,A)]===0&&(n[i(r,A)]=61)}}}}}}for(let c=Y-2;c>=0;c--){const S=t()<.5;for(let u=0;u<L;u++){const l=S?u:L-1-u,M=i(l,c),a=n[M];if(a===0)continue;const P=i(l,c+1),R=n[P];if(a===35||a===34||a===36){const E=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],o=a-31,[e,f]=E[o];if(e!==0&&e>0===S)continue;const T=l+e,s=c+f;if(T<0||T>=L||s<0||s>=Y){n[M]=39;continue}const r=i(T,s),A=n[r];if(A===22||A===11){n[r]=6,n[M]=39;continue}if(A===9||A===15||A===21||A===25||A===14){n[r]=a,n[M]=39;continue}if(A===2){if(t()<.15)n[M]=39;else{if(t()<.5)continue;n[r]=a,n[M]=39}continue}if(A===30){const I=T+e,N=s+f;I>=0&&I<L&&N>=0&&N<Y&&n[i(I,N)]===0&&(n[i(I,N)]=a),n[M]=39;continue}if(A===46){const I=[35,36,37,38,31,32,33,34];n[M]=I[a-31];continue}if(A===5||A===26||A===12||A===8||A===7||A>=31&&A<=38||A===39){n[r]=a,n[M]=39;continue}if(A===4||A===3||A===1){t()<.2||(n[r]=a),n[M]=39;continue}if(A===0){n[r]=a,n[M]=39;continue}n[M]=39;continue}if(a===39){t()<.3&&(n[M]=0);continue}if(a===23){c<Y-1&&n[P]===0&&t()<.15&&(n[P]=2);continue}if(a===24){if(t()<.06){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=15)}continue}if(a===27){if(t()<.035){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=25)}continue}if(a===29){if(t()<.02){const E=Math.floor(t()*3)-1,o=-1,e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=21)}continue}if(a===30){if(t()<.08){const E=[31,32,33,34,35,36,37,38],o=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],e=Math.floor(t()*8);for(let f=0;f<8;f++){const T=(e+f)%8,[s,r]=o[T],A=l+s,I=c+r;if(A>=0&&A<L&&I>=0&&I<Y&&n[i(A,I)]===0){n[i(A,I)]=E[T];break}}}continue}if(a===1)if(R===0)n[P]=1,n[M]=0;else if(R===2||R===41)n[P]=1,n[M]=R;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=1,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0&&(n[i(e,c+1)]=1,n[M]=0)}else if(a===2)if(R===0)n[P]=2,n[M]=0;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=2,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=2,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0?(n[i(o,c)]=2,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0&&(n[i(e,c)]=2,n[M]=0)}else if(a===3)R===0?(n[P]=3,n[M]=0):R===2&&(n[P]=3,n[M]=2);else if(a===8){if(t()<.3&&R===0)n[P]=8,n[M]=0;else if(t()<.15){const E=t()<.5?-1:1;l+E>=0&&l+E<L&&n[i(l+E,c+1)]===0&&(n[i(l+E,c+1)]=8,n[M]=0)}}else if(a===9){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(E!==0||o!==0){const r=l+E,A=c+o;if(r>=0&&r<L&&A>=0&&A<Y){const I=n[i(r,A)];if(I===6||I===10||I===13||I===19){n[M]=6;continue}}}if(t()<.5)continue;const e=Math.floor(t()*3)-1,f=t()<.7?1:Math.floor(t()*3)-1;if(e===0&&f===0)continue;const T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y){const r=i(T,s),A=n[r];A===5?(n[r]=9,n[M]=t()<.3?0:3):A===0?(n[r]=9,n[M]=0):A===2&&(n[r]=9,n[M]=2)}}else if(a===11){const E=c>0?n[i(l,c-1)]:0;if(R!==0&&R!==2&&R!==11||E!==0&&E!==2&&E!==11){for(let f=-12;f<=12;f++)for(let T=-12;T<=12;T++)if(T*T+f*f<=144){const s=l+T,r=c+f;if(s>=0&&s<L&&r>=0&&r<Y){const A=i(s,r),I=n[A];I===2?n[A]=t()<.7?4:0:I!==4&&I!==12&&(n[A]=6)}}continue}if(n[M]!==11)continue;if(R===0)n[P]=11,n[M]=0;else if(R===2)n[P]=11,n[M]=2;else{const e=t()<.5?-1:1,f=l+e,T=l-e;f>=0&&f<L&&n[i(f,c+1)]===0?(n[i(f,c+1)]=11,n[M]=0):T>=0&&T<L&&n[i(T,c+1)]===0?(n[i(T,c+1)]=11,n[M]=0):f>=0&&f<L&&n[i(f,c)]===0?(n[i(f,c)]=11,n[M]=0):T>=0&&T<L&&n[i(T,c)]===0&&(n[i(T,c)]=11,n[M]=0)}}else if(a===14){for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];if(s===6||s===10||s===19||s===42){n[M]=7;break}}}if(n[M]!==14||t()<.6)continue;if(R===0)n[P]=14,n[M]=0;else{const E=t()<.5?-1:1,o=l+E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=14,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0&&t()<.3&&(n[i(o,c)]=14,n[M]=0)}}else if(a===15){if(t()<.5)continue;const E=c>0?n[i(l,c-1)]:0,o=E===5||E===26||E===3,e=Math.floor(t()*3)-1,f=o?-1:t()<.7?1:Math.floor(t()*3)-1;if(e===0&&f===0)continue;const T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y){const r=i(T,s),A=n[r];if(A===6||A===10||A===42){n[M]=6;continue}if(A===41){n[M]=0;continue}if(A===2){n[r]=15,n[M]=2;continue}(A===3||A===1||A===5||A===26||A===0)&&(n[r]=15,n[M]=0)}}else if(a===16){if(t()<.4)continue;const E=Math.floor(t()*3)-1,o=t()<.3?1:Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];s===0?(n[T]=16,n[M]=t()<.1?14:0):s===9||s===15||s===21||s===25||s===14||s===5||s===26?(n[T]=16,n[M]=14):(s===6||s===10||s===13)&&(n[M]=14)}}else if(a===62){if(t()<.4)continue;const E=Math.floor(t()*3)-1,o=t()<.6?1:Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];if(s===6||s===42||s===41){n[M]=0;continue}if(s===21){n[M]=0;continue}s===3||s===1||s===0?(n[T]=62,n[M]=0):s===2&&(n[T]=62,n[M]=2)}}else if(a===63){if(t()<.3)continue;const E=Math.floor(t()*3)-1,o=t()<.6?-1:Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];if(s===6||s===42||s===10){n[M]=56;continue}s===0?(n[T]=63,n[M]=t()<.15?56:0):s===3||s===1?(n[T]=63,n[M]=26):s===2?(n[T]=63,n[M]=56):s===5?(n[T]=63,n[M]=26):s===4&&(n[M]=t()<.1?56:0)}}else if(a===17){if(t()<.03){n[M]=t()<.33?18:t()<.5?19:20;continue}const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(E===0&&o===0)continue;const e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=17,n[M]=0)}else if(a===18)t()<.002&&(n[M]=1);else if(a===19){if(t()<.05){n[M]=t()<.3?6:0;continue}for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];(s===5||s===8||s===7||s===26)&&t()<.4&&(n[i(f,T)]=6)}}if(R===0)n[P]=19,n[M]=0;else{const E=t()<.5?-1:1;l+E>=0&&l+E<L&&n[i(l+E,c+1)]===0&&(n[i(l+E,c+1)]=19,n[M]=0)}}else if(a===20){if(t()<.08){n[M]=0;continue}const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1;if(E!==0||o!==0){const e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=20,n[M]=0)}}else if(a===22){for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];if(s===6||s===10||s===19||s===42){for(let A=-6;A<=6;A++)for(let I=-6;I<=6;I++)if(I*I+A*A<=36){const N=l+I,d=c+A;if(N>=0&&N<L&&d>=0&&d<Y){const U=i(N,d),O=n[U];O!==4&&O!==12&&O!==2&&(n[U]=6)}}break}}}if(n[M]!==22)continue;if(R===0)n[P]=22,n[M]=0;else if(R===2)n[P]=22,n[M]=2;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=22,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0&&(n[i(e,c+1)]=22,n[M]=0)}}else if(a===28){if(t()>.15)continue;if(R===0)n[P]=28,n[M]=0;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=28,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=28,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0&&t()<.3?(n[i(o,c)]=28,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0&&t()<.3&&(n[i(e,c)]=28,n[M]=0)}}else if(a===41){let E=!1;for(let o=0;o<3;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y){const r=i(T,s),A=n[r];if((A===5||A===3||A===1||A===8||A===26||A===14)&&t()<.3){n[r]=t()<.7?0:7,t()<.4&&(n[M]=0,E=!0);break}if((A===4||A===12||A===18)&&t()<.08){n[r]=0,n[M]=0,E=!0;break}if((A===9||A===15||A===21||A===25)&&t()<.5){n[r]=41;break}}}if(E)continue;if(R===0)n[P]=41,n[M]=0;else{const o=t()<.5?-1:1,e=l+o,f=l-o;e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=41,n[M]=0):f>=0&&f<L&&n[i(f,c+1)]===0?(n[i(f,c+1)]=41,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0?(n[i(e,c)]=41,n[M]=0):f>=0&&f<L&&n[i(f,c)]===0&&(n[i(f,c)]=41,n[M]=0)}}else if(a===42){for(let E=0;E<3;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=i(f,T),r=n[s];if(r===2){if(n[s]=t()<.5?4:7,t()<.15){n[M]=4;break}}else r===43?n[s]=2:r===1&&t()<.4?n[s]=12:((r===5||r===8||r===7||r===26||r===22||r===27||r===29)&&t()<.7||(r===9||r===15||r===21||r===25)&&t()<.8)&&(n[s]=6)}}if(t()<.001){n[M]=4;continue}if(t()>.15)continue;if(R===0)n[P]=42,n[M]=0;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=42,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=42,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0&&t()<.3?(n[i(o,c)]=42,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0&&t()<.3&&(n[i(e,c)]=42,n[M]=0)}}else if(a===43){let E=!1;if(t()<.4)for(let o=-1;o<=1&&!E;o++)for(let e=-1;e<=1&&!E;e++){if(o===0&&e===0)continue;const f=l+e,T=c+o;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];(s===6||s===10||s===19||s===42)&&t()<.6?(n[M]=2,E=!0):s===2&&t()<.04&&(n[i(f,T)]=12)}}if(E)continue;if(t()<.25&&R===0)n[P]=43,n[M]=0;else if(t()<.1){const o=t()<.5?-1:1;l+o>=0&&l+o<L&&n[i(l+o,c+1)]===0&&(n[i(l+o,c+1)]=43,n[M]=0)}}else if(a===44){for(let E=0;E<3;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];if(s===2){if(n[i(f,T)]=7,t()<.08){n[M]=4;continue}}else s===43&&(n[i(f,T)]=2)}}if(n[M]===4)continue;if(t()<.55&&c>0){const E=i(l,c-1);n[E]===0&&(n[E]=42)}if(t()<.25){const E=t()<.5?-1:1;if(l+E>=0&&l+E<L&&c>0){const o=i(l+E,c-1);n[o]===0&&(n[o]=42)}}if(t()<.1){const E=Math.floor(t()*3)-1,o=Math.floor(t()*2)-1,e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=19)}}else if(a===45){if(t()<.008){n[M]=0;continue}for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];if(s===6||s===10||s===42||s===41){n[M]=s===41?0:6;break}}}if(n[M]===6||n[M]===0)continue;if(t()<.08){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];s===5||s===26||s===8||s===28||s===3?(n[T]=45,t()<.2&&(n[M]=t()<.4?50:7)):(s===9||s===15||s===14)&&t()<.3?n[T]=45:s===0&&t()<.1&&(n[T]=45,n[M]=t()<.3?7:0)}}}else if(a===46){for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];(s===9||s===15||s===21||s===25||s===14)&&t()<.5&&(n[i(f,T)]=0)}}if(R===0)n[P]=46,n[M]=0;else if(R===2||R===41||R===28||R===1||R===3)t()<.7&&(n[P]=46,n[M]=R);else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=46,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=46,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0?(n[i(o,c)]=46,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0&&(n[i(e,c)]=46,n[M]=0)}}else if(a===47){if(t()<.003){n[M]=0;continue}for(let E=0;E<2;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y&&n[i(f,T)]===13){n[M]=20;break}}if(n[M]===20)continue;if(t()<.1){const E=Math.floor(t()*3)-1,o=Math.floor(t()*3)-1,e=l+E,f=c+o;if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];if(s!==0&&s!==4&&s!==12&&s!==18&&s!==47&&s!==23&&s!==44&&(n[T]=0,t()<.02)){const r=l+Math.floor(t()*3)-1,A=c+Math.floor(t()*3)-1;r>=0&&r<L&&A>=0&&A<Y&&n[i(r,A)]===0&&(n[i(r,A)]=47)}}}}else if(a===5){if(t()<.92)continue;const E=Math.floor(t()*3)-1,o=t()<.7?-1:Math.floor(t()*3)-1,e=l+E,f=c+o;e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===2&&(n[i(e,f)]=t()<.1?26:5)}else if(a===48){const E=c>0?i(l,c-1):-1,o=E>=0?n[E]:0;if(!(R===2&&o!==2&&t()<.7)){if(R===2&&o===2){n[E]=48,n[M]=2;continue}else if(R===0){n[P]=48,n[M]=0;continue}}const e=Math.floor(t()*8),f=[0,1,1,1,0,-1,-1,-1][e],T=[-1,-1,0,1,1,1,0,-1][e],s=l+f,r=c+T;if(s>=0&&s<L&&r>=0&&r<Y){const x=n[i(s,r)];if(x===6||x===10||x===42){n[M]=6;continue}if((x===9||x===15||x===21)&&t()<.3){n[M]=0;continue}}if(t()>.35||!(c<Y-1&&(n[P]===3||n[P]===2)||o===3||o===2||o===5))continue;let I=!1,N=!1;for(let x=0;x<6;x++){const B=Math.floor(t()*13)-6,C=Math.floor(t()*13)-6,w=l+B,m=c+C;if(w>=0&&w<L&&m>=0&&m<Y){const j=n[i(w,m)];j===2&&(I=!0),j===57&&(N=!0)}}const d=N?.7:I?.5:.25;if(t()>d)continue;const U=N?50:I?30:20;let O=-1;for(let x=1;x<=U&&!(c-x<0);x++){const B=n[i(l,c-x)];if(B===0||B===2){O=c-x;break}if(B!==5&&B!==26&&B!==3&&B!==48)break}if(O>=0){const x=N?.3:I?.15:.1;n[i(l,O)]=t()<x?26:5}const y=c-(O>=0?O:c);if(y>10&&t()<(N?.2:.1)){const x=l+(t()<.5?-1:1),B=c-Math.floor(t()*Math.min(y,15))-5,C=x>=0&&x<L&&B>=0?n[i(x,B)]:-1;(C===0||C===2)&&(n[i(x,B)]=t()<.4?26:5)}}else if(a===49){if(t()<.005){n[M]=3;continue}let E=!1;for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1,T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y&&n[i(T,s)]===2){E=!0;break}}if(E&&t()<.03){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1,f=l+o,T=c+e;f>=0&&f<L&&T>=0&&T<Y&&n[i(f,T)]===4&&(n[i(f,T)]=49)}R===0&&t()<.1&&(n[P]=49,n[M]=0)}else if(a===51){let E=!1;if((c>0&&n[i(l,c-1)]===2||c<Y-1&&n[i(l,c+1)]===2||l>0&&n[i(l-1,c)]===2||l<L-1&&n[i(l+1,c)]===2)&&(E=!0),!E&&t()<.001){n[M]=5;continue}if(E&&t()<.015&&c>0){const o=i(l,c-1);n[o]===2&&(n[o]=7)}if(E&&t()<.06){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1,f=l+o,T=c+e;f>=0&&f<L&&T>=0&&T<Y&&n[i(f,T)]===2&&(n[i(f,T)]=51)}for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y){const r=n[i(T,s)];if((r===9||r===14)&&t()<.25){n[M]=0;break}}}}else if(a===52){for(let E=0;E<3;E++){const o=Math.floor(t()*3)-1,e=Math.floor(t()*3)-1;if(o===0&&e===0)continue;const f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=n[i(f,T)];(s===9||s===15||s===21||s===25||s===14)&&t()<.5||s===51&&t()<.08||s===5&&t()<.05?n[i(f,T)]=52:s===2&&t()<.15&&(n[i(f,T)]=0,t()<.5&&(n[M]=2))}}if(t()>.3)continue;if(R===0)n[P]=52,n[M]=0;else{const E=t()<.5?-1:1,o=l+E,e=l-E;o>=0&&o<L&&n[i(o,c+1)]===0?(n[i(o,c+1)]=52,n[M]=0):e>=0&&e<L&&n[i(e,c+1)]===0?(n[i(e,c+1)]=52,n[M]=0):o>=0&&o<L&&n[i(o,c)]===0?(n[i(o,c)]=52,n[M]=0):e>=0&&e<L&&n[i(e,c)]===0&&(n[i(e,c)]=52,n[M]=0)}}else if(a===53){let E=!1;for(let o=0;o<2;o++){const e=Math.floor(t()*3)-1,f=Math.floor(t()*3)-1;if(e===0&&f===0)continue;const T=l+e,s=c+f;if(T>=0&&T<L&&s>=0&&s<Y){const r=n[i(T,s)];if(r===6||r===10||r===19||r===42){n[M]=6;for(let A=0;A<10;A++){const I=Math.floor(t()*5)-2,N=Math.floor(t()*5)-2,d=l+I,U=c+N;d>=0&&d<L&&U>=0&&U<Y&&n[i(d,U)]===53&&t()<.8&&(n[i(d,U)]=6)}E=!0;break}}}if(E)continue;if(t()<.003){n[M]=1;continue}if(t()<.3){const o=Math.floor(t()*3)-1,e=t()<.6?1:t()<.5?0:-1,f=l+o,T=c+e;f>=0&&f<L&&T>=0&&T<Y&&n[i(f,T)]===0&&(n[i(f,T)]=53,n[M]=0)}}else if(a===56){let E=0;for(let e=0;e<3;e++){const f=Math.floor(t()*3)-1,T=Math.floor(t()*3)-1;if(f===0&&T===0)continue;const s=l+f,r=c+T;s>=0&&s<L&&r>=0&&r<Y&&n[i(s,r)]===56&&E++}const o=E===0?.15:E>0?.03:.01;if(t()<o){n[M]=0;continue}if(t()<.3)if(R===0)n[P]=56,n[M]=0;else{const e=t()<.5?-1:1;l+e>=0&&l+e<L&&n[i(l+e,c+1)]===0&&(n[i(l+e,c+1)]=56,n[M]=0)}}else if(a===57){if(t()<.12){const E=t()*6.28318,o=t()*4+1,e=l+Math.round(Math.cos(E)*o),f=c+Math.round(Math.sin(E)*o);e>=0&&e<L&&f>=0&&f<Y&&n[i(e,f)]===0&&(n[i(e,f)]=t()<.6?20:56)}if(t()<.04){const E=t()*6.28318,o=t()*12+3,e=l+Math.round(Math.cos(E)*o),f=c+Math.round(Math.sin(E)*o);if(e>=0&&e<L&&f>=0&&f<Y){const T=i(e,f),s=n[T];s===5&&t()<.3?n[T]=26:s===2&&t()<.1?n[T]=51:s===3&&t()<.15||s===0&&t()<.05?n[T]=5:s===43&&t()<.2?n[T]=2:s===45&&t()<.1&&(n[T]=26)}}if(t()<.02)for(let E=0;E<5;E++){const o=Math.floor(t()*5)-2,e=Math.floor(t()*5)-2,f=l+o,T=c+e;if(f>=0&&f<L&&T>=0&&T<Y){const s=i(f,T);n[s]===2&&(n[s]=7)}}}else if(a===60){if(t()>.5)continue;const E=10;for(let o=0;o<16;o++){const e=t()*6.28318,f=t()*E+1,T=Math.round(Math.cos(e)*f),s=Math.round(Math.sin(e)*f);if(T===0&&s===0)continue;const r=l+T,A=c+s;if(r<0||r>=L||A<0||A>=Y)continue;const I=i(r,A),N=n[I];if(N===0||N===60||N===44||N===30||N===24||N===27)continue;const d=T>0?-1:T<0?1:0,U=s>0?-1:s<0?1:0,O=r+d,y=A+U;if(O>=0&&O<L&&y>=0&&y<Y){const x=i(O,y);Math.abs(T+d)<=1&&Math.abs(s+U)<=1?n[I]=0:n[x]===0&&(n[x]=N,n[I]=0)}}for(let o=-6;o<=6;o+=2){const e=l+o;if(!(e<0||e>=L))for(let f=-8;f<=2;f+=2){const T=c+f;if(T<0||T>=Y)continue;const s=i(e,T),r=n[s];if(!(r===0||r===60)&&Math.abs(o)>1&&t()<.3){const A=o>0?-1:1,I=e+A;I>=0&&I<L&&n[i(I,T)]===0&&(n[i(I,T)]=r,n[s]=0)}}}}}}}function tn(){if(!W||!_||!F)return;const n=h,t=F.width,i=new Uint32Array(_.data.buffer);i.fill(J);const c=g;for(let S=0;S<Y;S++){const u=S*L,l=S*c*t;for(let M=0;M<L;M++){const a=n[u+M];if(a===0)continue;let P;a===6?P=p[M+S&31]:a===10?P=v[M+S&63]:a===13?P=V[M+S&31]:a===59?P=K[M+S&31]:P=z[a];const R=M*c,E=l+R,o=E+t,e=o+t,f=e+t;i[E]=i[E+1]=i[E+2]=i[E+3]=P,i[o]=i[o+1]=i[o+2]=i[o+3]=P,i[e]=i[e+1]=i[e+2]=i[e+3]=P,i[f]=i[f+1]=i[f+2]=i[f+3]=P}}W.putImageData(_,0,0)}let G=0,D=0;const k=1e3/60;function X(n){G===0&&(G=n);const t=Math.min(n-G,100);G=n;for(const i of H)$(i.x,i.y,i.tool,i.brushSize);H=[],q||(D+=t,D>=k&&(nn(),D=Math.min(D-k,k))),tn(),requestAnimationFrame(X)}self.onmessage=n=>{const{type:t,data:i}=n.data;switch(t){case"init":F=n.data.canvas,W=F.getContext("2d",{willReadFrequently:!1}),Q(F.width,F.height),G=0,D=0,requestAnimationFrame(X);break;case"resize":F&&(F.width=i.width,F.height=i.height,Q(i.width,i.height));break;case"input":H.push({x:i.cellX,y:i.cellY,tool:i.tool,brushSize:i.brushSize});break;case"pause":q=i.paused;break;case"reset":h.fill(0);break}}})();
